<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
  크로스 파일 include 테스트용 MyBatis 매퍼
  다른 매퍼 파일의 SQL 조각을 참조하는 테스트
-->
<mapper namespace="com.example.testcase.TestCrossFileIncludeMapper">

    <!-- 
    TestIncludeMapper.xml의 SQL 조각을 참조
    크로스 파일 include 테스트
    -->
    <select id="testCrossFileInclude" resultType="map">
        SELECT <include refid="com.example.testcase.TestIncludeMapper.baseUserFields"/>,
               up.full_name, us.theme
        FROM users u
        <include refid="com.example.testcase.TestIncludeMapper.userProfileJoins"/>
        WHERE u.status = 'ACTIVE'
        ORDER BY u.created_date DESC
    </select>
    
    <!-- 
    자체 SQL 조각 정의 (다른 파일에서 참조 가능)
    -->
    <sql id="paymentJoins">
        LEFT JOIN payments pm ON o.order_id = pm.order_id
        LEFT JOIN payment_methods pmt ON pm.payment_method_id = pmt.method_id
    </sql>
    
    <!-- 
    복합 크로스 파일 include 테스트
    -->
    <select id="testComplexCrossFileInclude" resultType="map">
        SELECT <include refid="com.example.testcase.TestIncludeMapper.baseUserFields"/>,
               o.order_date, pm.payment_amount, pmt.method_name
        FROM users u
        <include refid="com.example.testcase.TestIncludeMapper.orderJoins"/>
        <include refid="paymentJoins"/>
        WHERE u.status = 'ACTIVE'
        AND o.status = 'COMPLETED'
        ORDER BY o.order_date DESC
    </select>
    
    <!-- 
    동적 SQL + 크로스 파일 include 조합
    -->
    <select id="testDynamicWithCrossFileInclude" resultType="map">
        SELECT <include refid="com.example.testcase.TestIncludeMapper.baseUserFields"/>
        <if test="includeOrderInfo == 'Y'">
            , o.order_date, o.total_amount
        </if>
        <if test="includePaymentInfo == 'Y'">
            , pm.payment_amount, pmt.method_name
        </if>
        FROM users u
        <if test="includeOrderInfo == 'Y'">
            <include refid="com.example.testcase.TestIncludeMapper.orderJoins"/>
        </if>
        <if test="includePaymentInfo == 'Y'">
            <include refid="paymentJoins"/>
        </if>
        WHERE u.status = 'ACTIVE'
        ORDER BY u.created_date DESC
    </select>

</mapper>
