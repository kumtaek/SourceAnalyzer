<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sequence Diagram Report - SampleSrc</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.1/dist/mermaid.min.js"></script>
    <link rel="stylesheet" href="css/woori.css">
    <style>
        /* === Sequence Diagram 전용 스타일 === */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 2px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            width: 100%;
            max-width: 100%;
            margin: 0;
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: 100vh;
        }
        
        .content {
            padding: 6px;
        }
        
        .section {
            margin-bottom: 8px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
            overflow: hidden;
        }
        
        .section h2 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding: 8px 12px;
            margin: 0;
            font-size: 1.1em;
            background: #f8f9fa;
        }
        
        .diagram-description {
            color: #7f8c8d;
            margin: 8px 12px;
            font-style: italic;
            font-size: 0.9em;
        }
        
        .diagram-controls {
            padding: 8px 12px;
            text-align: right;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .btn {
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: var(--border-radius-small);
            cursor: pointer;
            margin-left: 5px;
            font-size: 0.8em;
            transition: background-color 0.3s ease;
        }
        
        .btn:hover {
            background: var(--primary-dark);
        }
        
        /* === Mermaid 시퀀스 다이어그램 최적화 === */
        .mermaid-container {
            background: white;
            padding: 15px;
            overflow-x: auto;
            overflow-y: hidden;
            /* 가로 스크롤 허용하여 축소 방지 */
            min-width: 100%;
            max-height: 70vh;
        }
        
        .mermaid {
            /* 시퀀스 다이어그램 최소 너비 보장 */
            min-width: 800px;
            width: max-content;
            margin: 0 auto;
            font-size: 14px;
        }
        
        /* === 시퀀스 다이어그램 스크롤바 스타일링 === */
        .mermaid-container::-webkit-scrollbar {
            height: 8px;
        }
        
        .mermaid-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        .mermaid-container::-webkit-scrollbar-thumb {
            background: var(--primary-blue);
            border-radius: 4px;
        }
        
        .mermaid-container::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
        
        /* === 반응형 최적화 === */
        @media (max-width: 768px) {
            .mermaid {
                min-width: 600px;
                font-size: 12px;
            }
        }
        
        /* === 다이어그램별 색상 구분 === */
        .diagram-full-chain .mermaid-container {
            border-left: 4px solid #27ae60;
        }
        
        .diagram-method-call .mermaid-container {
            border-left: 4px solid #e74c3c;
        }
        
        .diagram-layer-based .mermaid-container {
            border-left: 4px solid #f39c12;
        }
        
        .diagram-query-type .mermaid-container {
            border-left: 4px solid #9b59b6;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- woori.css 헤더 스타일 적용 -->
        <div class="header">
            <h1>Sequence Diagram Report</h1>
            <div class="subtitle">프로젝트: SampleSrc | 생성일시: 2025-09-19 16:03:08</div>
        </div>
        
        <!-- woori.css 통계 스타일 적용 -->
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number">32</div>
                <div class="stat-label">호출 체인</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">1848</div>
                <div class="stat-label">메서드 호출</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">80</div>
                <div class="stat-label">쿼리 호출</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">11</div>
                <div class="stat-label">아키텍처 레이어</div>
            </div>
        </div>
        
        
        <div class="content">
            
            <div class="section diagram-full_chain">
                <h2>[Full Chain] Full Call Chain Sequence</h2>
                <p class="diagram-description">프론트엔드부터 데이터베이스까지의 완전한 호출 체인 (데이터: 10건)</p>
                <div class="diagram-controls">
                    <button class="btn" onclick="zoomDiagram('diagram_full_chain', 1.2)" title="확대">확대</button>
                    <button class="btn" onclick="zoomDiagram('diagram_full_chain', 0.8)" title="축소">축소</button>
                    <button class="btn" onclick="zoomDiagram('diagram_full_chain', 1)" title="원본크기">100%</button>
                    <button class="btn" onclick="exportDiagram('diagram_full_chain', 'png')">PNG</button>
                    <button class="btn" onclick="exportDiagram('diagram_full_chain', 'svg')">SVG</button>
                </div>
                <div class="mermaid-container">
                    <div id="diagram_full_chain" class="mermaid">
sequenceDiagram
    participant API_Gateway as API_Gateway
    participant Database as Database
    participant Frontend as Frontend
    participant MicroserviceController as MicroserviceController
    participant ProxyController as ProxyController
    participant VersionedController as VersionedController
    participant VersionedService as VersionedService
    participant XML_Mapper as XML_Mapper

    Note over Frontend,Database: Flow 1 - /api/dashboard:GET
    Frontend->>API_Gateway: /api/dashboard:GET
    API_Gateway->>MicroserviceController: getDashboardData()
    MicroserviceController->>XML_Mapper: selectDashboardData
    XML_Mapper->>Database: SELECT FROM USERS,ORDERS,PRODUCTS
    Database-->>XML_Mapper: Result Set
    XML_Mapper-->>MicroserviceController: Data
    MicroserviceController-->>API_Gateway: Response
    API_Gateway-->>Frontend: JSON Data

    Note over Frontend,Database: Flow 2 - /api/notify:POST
    Frontend->>API_Gateway: /api/notify:POST
    API_Gateway->>MicroserviceController: sendNotification()
    Note right of MicroserviceController: Calculation Only
    MicroserviceController-->>API_Gateway: Response
    API_Gateway-->>Frontend: JSON Data

    Note over Frontend,Database: Flow 3 - /api/order-details:GET
    Frontend->>API_Gateway: /api/order-details:GET
    API_Gateway->>MicroserviceController: getOrderDetails()
    Note right of MicroserviceController: Calculation Only
    MicroserviceController-->>API_Gateway: Response
    API_Gateway-->>Frontend: JSON Data

    Note over Frontend,Database: Flow 4 - /api/orders:GET
    Frontend->>API_Gateway: /api/orders:GET
    API_Gateway->>ProxyController: getOrders()
    Note right of ProxyController: Calculation Only
    ProxyController-->>API_Gateway: Response
    API_Gateway-->>Frontend: JSON Data

    Note over Frontend,Database: Flow 5 - /api/orders:GET
    Frontend->>API_Gateway: /api/orders:GET
    API_Gateway->>VersionedController: getOrdersV1()
    VersionedController->>XML_Mapper: selectOrdersV2
    XML_Mapper-->>VersionedController: Data
    VersionedController-->>API_Gateway: Response
    API_Gateway-->>Frontend: JSON Data

    Note over Frontend,Database: Flow 6 - /api/orders:GET
    Frontend->>API_Gateway: /api/orders:GET
    API_Gateway->>VersionedService: getOrdersV2()
    VersionedService->>XML_Mapper: selectOrdersV2
    XML_Mapper-->>VersionedService: Data
    VersionedService-->>API_Gateway: Response
    API_Gateway-->>Frontend: JSON Data

    Note over Frontend,Database: Flow 7 - /api/payment:POST
    Frontend->>API_Gateway: /api/payment:POST
    API_Gateway->>ProxyController: processPayment()
    Note right of ProxyController: Calculation Only
    ProxyController-->>API_Gateway: Response
    API_Gateway-->>Frontend: JSON Data

    Note over Frontend,Database: Flow 8 - /api/products:GET
    Frontend->>API_Gateway: /api/products:GET
    API_Gateway->>ProxyController: getProducts()
    ProxyController->>XML_Mapper: selectProductsFromInternalService
    XML_Mapper->>Database: SELECT FROM PRODUCTS,CATEGORIES,BRANDS
    Database-->>XML_Mapper: Result Set
    XML_Mapper-->>ProxyController: Data
    ProxyController-->>API_Gateway: Response
    API_Gateway-->>Frontend: JSON Data

    Note over Frontend,Database: Flow 9 - /api/products:GET
    Frontend->>API_Gateway: /api/products:GET
    API_Gateway->>VersionedController: getProductsV1()
    VersionedController->>XML_Mapper: selectProductsV1
    XML_Mapper-->>VersionedController: Data
    VersionedController-->>API_Gateway: Response
    API_Gateway-->>Frontend: JSON Data

    Note over Frontend,Database: Flow 10 - /api/products:GET
    Frontend->>API_Gateway: /api/products:GET
    API_Gateway->>VersionedService: getProductsV2()
    Note right of VersionedService: Calculation Only
    VersionedService-->>API_Gateway: Response
    API_Gateway-->>Frontend: JSON Data

                    </div>
                </div>
            </div>
            

            <div class="section diagram-method_call">
                <h2>[Method Call] Method Call Sequence</h2>
                <p class="diagram-description">Java 메서드 간 호출 관계 (데이터: 15건)</p>
                <div class="diagram-controls">
                    <button class="btn" onclick="zoomDiagram('diagram_method_call', 1.2)" title="확대">확대</button>
                    <button class="btn" onclick="zoomDiagram('diagram_method_call', 0.8)" title="축소">축소</button>
                    <button class="btn" onclick="zoomDiagram('diagram_method_call', 1)" title="원본크기">100%</button>
                    <button class="btn" onclick="exportDiagram('diagram_method_call', 'png')">PNG</button>
                    <button class="btn" onclick="exportDiagram('diagram_method_call', 'svg')">SVG</button>
                </div>
                <div class="mermaid-container">
                    <div id="diagram_method_call" class="mermaid">
sequenceDiagram
    participant CommentHeavyClass as CommentHeavyClass
    participant LargeBusinessClass as LargeBusinessClass
    participant ProductController as ProductController
    participant UserController as UserController
    participant UserDao as UserDao

    Note over CommentHeavyClass,LargeBusinessClass,ProductController,UserController,UserDao: Method Call Chain
    UserDao->>UserDao: findUsersByCondition()
    UserDao-->>UserDao: return
    UserDao->>UserDao: processUserData()
    UserDao-->>UserDao: return
    UserDao->>UserDao: validateAndSetDefaults()
    UserDao-->>UserDao: return
    UserDao->>UserDao: processUserData()
    UserDao-->>UserDao: return
    CommentHeavyClass->>CommentHeavyClass: methodWithMixedCommentsAndStrings()
    CommentHeavyClass-->>CommentHeavyClass: return
    LargeBusinessClass->>LargeBusinessClass: setDataCache()
    LargeBusinessClass-->>LargeBusinessClass: return
    LargeBusinessClass->>LargeBusinessClass: getProcessedDataKeys()
    LargeBusinessClass-->>LargeBusinessClass: return
    LargeBusinessClass->>LargeBusinessClass: getProcessedDataKeys()
    LargeBusinessClass-->>LargeBusinessClass: return
    LargeBusinessClass->>LargeBusinessClass: updateProcessingQueue()
    LargeBusinessClass-->>LargeBusinessClass: return
    LargeBusinessClass->>LargeBusinessClass: validateProcessingResult()
    LargeBusinessClass-->>LargeBusinessClass: return
    LargeBusinessClass->>LargeBusinessClass: processBatchData()
    LargeBusinessClass-->>LargeBusinessClass: return
    LargeBusinessClass->>LargeBusinessClass: processBatchData()
    LargeBusinessClass-->>LargeBusinessClass: return
    ProductController->>ProductController: updateProductStock()
    ProductController-->>ProductController: return
    UserController->>UserController: calculateUserStatistics()
    UserController-->>UserController: return
    UserController->>UserController: analyzeSearchResults()
    UserController-->>UserController: return
                    </div>
                </div>
            </div>
            

            <div class="section diagram-layer_based">
                <h2>[Layer Based] Layer-based Sequence</h2>
                <p class="diagram-description">시스템 레이어별 호출 관계 (데이터: 10건)</p>
                <div class="diagram-controls">
                    <button class="btn" onclick="zoomDiagram('diagram_layer_based', 1.2)" title="확대">확대</button>
                    <button class="btn" onclick="zoomDiagram('diagram_layer_based', 0.8)" title="축소">축소</button>
                    <button class="btn" onclick="zoomDiagram('diagram_layer_based', 1)" title="원본크기">100%</button>
                    <button class="btn" onclick="exportDiagram('diagram_layer_based', 'png')">PNG</button>
                    <button class="btn" onclick="exportDiagram('diagram_layer_based', 'svg')">SVG</button>
                </div>
                <div class="mermaid-container">
                    <div id="diagram_layer_based" class="mermaid">
sequenceDiagram
    participant API_ENTRY as API_ENTRY_Layer
    participant CONTROLLER as CONTROLLER_Layer
    participant SERVICE as SERVICE_Layer
    participant APPLICATION as APPLICATION_Layer
    participant MODEL as MODEL_Layer
    participant QUERY as QUERY_Layer
    participant REPOSITORY as REPOSITORY_Layer
    participant TABLE as TABLE_Layer

    Note over API_ENTRY,CONTROLLER,SERVICE,APPLICATION,MODEL,QUERY,REPOSITORY,TABLE: Layered Architecture Flow
    QUERY->>TABLE: USE_TABLE (435)
    TABLE-->>QUERY: Response
    SERVICE->>APPLICATION: Method Call (415)
    APPLICATION-->>SERVICE: Response
    CONTROLLER->>APPLICATION: Method Call (363)
    APPLICATION-->>CONTROLLER: Response
    REPOSITORY->>APPLICATION: Method Call (202)
    APPLICATION-->>REPOSITORY: Response
    MODEL->>APPLICATION: Method Call (104)
    APPLICATION-->>MODEL: Response
    SERVICE->>MODEL: Method Call (72)
    MODEL-->>SERVICE: Response
    APPLICATION->>MODEL: Method Call (48)
    MODEL-->>APPLICATION: Response
    CONTROLLER->>SERVICE: Method Call (36)
    SERVICE-->>CONTROLLER: Response
    CONTROLLER->>QUERY: Query Call (32)
    QUERY-->>CONTROLLER: Response
    API_ENTRY->>CONTROLLER: Method Call (29)
    CONTROLLER-->>API_ENTRY: Response
                    </div>
                </div>
            </div>
            

            <div class="section diagram-query_type">
                <h2>[Query Type] Query Type Sequence</h2>
                <p class="diagram-description">쿼리 타입별 호출 관계 (XML-based vs Inferred) (데이터: 8건)</p>
                <div class="diagram-controls">
                    <button class="btn" onclick="zoomDiagram('diagram_query_type', 1.2)" title="확대">확대</button>
                    <button class="btn" onclick="zoomDiagram('diagram_query_type', 0.8)" title="축소">축소</button>
                    <button class="btn" onclick="zoomDiagram('diagram_query_type', 1)" title="원본크기">100%</button>
                    <button class="btn" onclick="exportDiagram('diagram_query_type', 'png')">PNG</button>
                    <button class="btn" onclick="exportDiagram('diagram_query_type', 'svg')">SVG</button>
                </div>
                <div class="mermaid-container">
                    <div id="diagram_query_type" class="mermaid">
sequenceDiagram
    participant Client as Client
    participant App as Application
    participant XML as XML_Mapper
    participant Inferred as Inferred_Query
    participant DB as Database

    Note over Client,DB: Different Query Types

    rect rgb(255, 255, 200)
        Note right of Client: Inferred Queries
        Client->>App: deleteUsersByCondition()
        App->>Inferred: countUsersByCondition
        Note right of Inferred: Java에서 추론된 쿼리
        Inferred->>DB: Inferred SQL
        DB-->>Inferred: Result
        Inferred-->>App: Data
        App-->>Client: Response
        Client->>App: getUserById()
        App->>Inferred: countUsersByCondition
        Note right of Inferred: Java에서 추론된 쿼리
        Inferred->>DB: Inferred SQL
        DB-->>Inferred: Result
        Inferred-->>App: Data
        App-->>Client: Response
    end
                    </div>
                </div>
            </div>
            
        </div>
        
        <!-- woori.css 푸터 스타일 적용 -->
        <div class="footer">
            <p>Sequence Diagram Report | Generated by SourceAnalyzer</p>
        </div>
    </div>

    <script>
        // Mermaid 초기화 - 시퀀스 다이어그램 최적화
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            securityLevel: 'loose',
            sequence: {
                diagramMarginX: 30,
                diagramMarginY: 15,
                actorMargin: 60,
                width: 120,
                height: 50,
                boxMargin: 8,
                boxTextMargin: 4,
                noteMargin: 8,
                messageMargin: 30,
                mirrorActors: false,
                bottomMarginAdj: 1,
                useMaxWidth: false,  // 축소 방지
                rightAngles: false,
                showSequenceNumbers: false,
                wrap: false,
                fontSize: 14
            },
            flowchart: {
                useMaxWidth: false
            }
        });

        // 다이어그램 내보내기 함수 개선
        function exportDiagram(diagramId, format) {
            const element = document.getElementById(diagramId);
            if (!element) {
                alert('다이어그램을 찾을 수 없습니다.');
                return;
            }
            
            try {
                if (format === 'png') {
                    // PNG 내보내기 로직 (향후 구현)
                    console.log('PNG 내보내기:', diagramId);
                    alert('PNG 내보내기 기능은 준비 중입니다.');
                } else if (format === 'svg') {
                    // SVG 내보내기 로직 (향후 구현)
                    console.log('SVG 내보내기:', diagramId);
                    alert('SVG 내보내기 기능은 준비 중입니다.');
                }
            } catch (error) {
                console.error('내보내기 오류:', error);
                alert('내보내기 중 오류가 발생했습니다.');
            }
        }

        // 다이어그램 확대/축소 함수
        function zoomDiagram(diagramId, scale) {
            const element = document.getElementById(diagramId);
            if (!element) return;
            
            const currentTransform = element.style.transform;
            const currentScale = currentTransform.match(/scale\(([^)]+)\)/);
            const newScale = currentScale ? parseFloat(currentScale[1]) * scale : scale;
            
            element.style.transform = `scale(${newScale})`;
            element.style.transformOrigin = 'top left';
        }

        // 페이지 로드 완료 후 Mermaid 렌더링
        document.addEventListener('DOMContentLoaded', function() {
            // 순차적으로 다이어그램 렌더링
            setTimeout(() => {
                mermaid.init(undefined, '.mermaid').then(() => {
                    console.log('모든 시퀀스 다이어그램 렌더링 완료');
                }).catch(error => {
                    console.error('Mermaid 렌더링 오류:', error);
                });
            }, 100);
        });

        // 스크롤 위치 저장/복원
        window.addEventListener('beforeunload', function() {
            sessionStorage.setItem('scrollPosition', window.scrollY);
        });

        window.addEventListener('load', function() {
            const scrollPosition = sessionStorage.getItem('scrollPosition');
            if (scrollPosition) {
                window.scrollTo(0, parseInt(scrollPosition));
                sessionStorage.removeItem('scrollPosition');
            }
        });
    </script>
</body>
</html>