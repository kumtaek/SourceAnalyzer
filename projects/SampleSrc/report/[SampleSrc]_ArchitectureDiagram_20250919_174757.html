<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>시스템 아키텍처 분석 리포트 - SampleSrc</title>
    <style>
        
        
        :root {
            /* === 메인 컬러 === */
            --primary-blue: #1976d2;         /* 메인 브랜드 블루 */
            --primary-dark: #0d47a1;         /* 진한 블루 (강조용) */
            --primary-light: #42a5f5;        /* 밝은 블루 (액션 버튼) */
            --primary-pale: #e3f2fd;         /* 아주 연한 블루 (배경) */
            
            /* === 보조 컬러 === */
            --secondary-blue: #1565c0;       /* 보조 블루 */
            --accent-blue: #2196f3;          /* 액센트 블루 */
            --sky-blue: #81d4fa;             /* 하늘색 */
            --ice-blue: #f1f8ff;             /* 아이스 블루 (최상단 배경) */
            
            /* === 그라데이션 === */
            --gradient-main: linear-gradient(135deg, #1976d2 0%, #42a5f5 100%);
            --gradient-subtle: linear-gradient(135deg, #e3f2fd 0%, #ffffff 100%);
            --gradient-header: linear-gradient(90deg, #0d47a1 0%, #1976d2 100%);
            
            /* === 중성 컬러 === */
            --gray-50: #fafafa;
            --gray-100: #f5f5f5;
            --gray-200: #eeeeee;
            --gray-300: #e0e0e0;
            --gray-400: #bdbdbd;
            --gray-500: #9e9e9e;
            --gray-600: #757575;
            --gray-700: #616161;
            --gray-800: #424242;
            --gray-900: #212121;
            
            /* === 텍스트 컬러 === */
            --text-primary: #212121;
            --text-secondary: #616161;
            --text-hint: #9e9e9e;
            --text-on-primary: #ffffff;
            
            /* === 상태 컬러 === */
            --success: #4caf50;
            --warning: #ff9800;
            --error: #f44336;
            --info: var(--primary-blue);
            
            /* === 쉐도우 === */
            --shadow-light: 0 2px 4px rgba(25, 118, 210, 0.12);
            --shadow-medium: 0 4px 8px rgba(25, 118, 210, 0.16);
            --shadow-heavy: 0 8px 16px rgba(25, 118, 210, 0.24);
            
            /* === 보더 === */
            --border-light: 1px solid rgba(25, 118, 210, 0.12);
            --border-medium: 1px solid rgba(25, 118, 210, 0.24);
            --border-radius: 8px;
            --border-radius-small: 4px;
            --border-radius-large: 12px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 5px;
            background-color: var(--ice-blue);
            line-height: 1.4;
        }
        .container {
            max-width: 95%;
            margin: 0 auto;
            background: white;
            padding: 8px;
            border-radius: var(--border-radius-large);
            box-shadow: var(--shadow-medium);
        }
        .header {
            background: linear-gradient(90deg, #0d47a1 0%, #1976d2 100%);
            color: white;
            padding: 8px;
            text-align: center;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(25, 118, 210, 0.12);
            margin-bottom: 3px;
            padding-bottom: 3px;
        }
        .header h1 {
            margin: 0;
            font-size: 1.4em;
            font-weight: 300;
            color: white;
        }
        .header .subtitle {
            margin: 2px 0 0 0;
            opacity: 0.9;
            font-size: 0.8em;
            color: white;
        }
        .section {
            margin: 2px 0;
            padding: 3px;
            border-left: 3px solid var(--primary-blue);
            background-color: var(--primary-pale);
        }
        .section h2 {
            color: var(--primary-blue);
            margin-top: 0;
            margin-bottom: 2px;
            font-size: 1.1em;
        }
        .diagram-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        .diagram-header h2 {
            margin: 0;
            flex: 1;
        }
        .diagram-controls {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 8px;
        }
        .diagram-controls button {
            background: #3498db;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.7em;
            transition: all 0.3s ease;
        }
        .diagram-controls button:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }
        .diagram-container {
            background: white;
            padding: 2px;
            border-radius: var(--border-radius);
            margin: 2px 0;
            box-shadow: var(--shadow-light);
            width: 100%;
            box-sizing: border-box;
        }
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin: 5px 0;
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-light);
        }
        .stats-table th, .stats-table td {
            border: var(--border-light);
            padding: 4px;
            text-align: left;
        }
        .stats-table th {
            background-color: var(--primary-blue);
            color: var(--text-on-primary);
            font-weight: bold;
        }
        .stats-table tr:nth-child(even) {
            background-color: var(--gray-50);
        }
        .relationship-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .relationship-card {
            background: white;
            border: 2px solid #28a745;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .relationship-header {
            background: #28a745;
            color: white;
            padding: 15px;
            font-weight: bold;
            text-align: center;
        }
        .relationship-body {
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        .relationship-item {
            margin: 5px 0;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .timestamp {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-top: 30px;
            padding-top: 20px;
            border-top: var(--border-light);
        }
        
        /* 반응형 아키텍처 다이어그램 스타일 */
        .architecture-diagram {
            width: 100%;
            margin: 20px 0;
        }
        
        .layer-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .layer {
            border: 2px solid;
            border-radius: 8px;
            padding: 15px;
            /* 높이 자동 조정 - min-height 제거 */
        }
        
        .layer-header {
            margin-bottom: 15px;
        }
        
        .layer-header h3 {
            margin: 0;
            font-size: 1.1em;
            font-weight: bold;
        }
        
        .components-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        .component {
            background: white;
            border: 1px solid var(--primary-blue);
            border-radius: var(--border-radius-small);
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 500;
            min-width: 120px;
            text-align: center;
            box-shadow: var(--shadow-light);
            color: var(--text-primary);
            transition: all 0.2s ease;
        }
        .component:hover {
            background-color: var(--primary-pale);
            border-color: var(--primary-dark);
            box-shadow: var(--shadow-medium);
        }
        
        .layer-arrow {
            text-align: center;
            font-size: 24px;
            color: var(--primary-blue);
            margin: 10px 0;
            font-weight: bold;
        }
        
        .empty-layer {
            text-align: center;
            color: var(--text-hint);
            font-style: italic;
        }
        
        .more-indicator {
            background: var(--primary-pale) !important;
            border-color: var(--primary-blue) !important;
            color: var(--primary-blue) !important;
            font-weight: bold !important;
        }
        
        /* 반응형 브레이크포인트 */
        @media (max-width: 1200px) {
            .component {
                min-width: 110px;
                font-size: 11px;
                padding: 6px 10px;
            }
        }
        
        @media (max-width: 992px) {
            .component {
                min-width: 100px;
                font-size: 10px;
                padding: 5px 8px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 15px;
            }
            .header h1 {
                font-size: 1.8em;
            }
            .component {
                min-width: 90px;
                font-size: 9px;
                padding: 4px 6px;
            }
            .layer {
                padding: 10px;
            }
            .relationship-grid {
                grid-template-columns: 1fr;
            }
            .diagram-controls {
                flex-direction: column;
                align-items: stretch;
            }
            .controls-right {
                justify-content: center;
            }
            .diagram-controls button {
                margin: 2px 0;
            }
        }
        
        @media (max-width: 576px) {
            .component {
                min-width: 80px;
                font-size: 8px;
                padding: 3px 5px;
            }
            .layer-header h3 {
                font-size: 1em;
            }
        }
        
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>시스템 아키텍처 분석</h1>
            <div class="subtitle">프로젝트: SampleSrc | 생성일시: 2025-09-19 17:47:57</div>
        </div>
        
        <div class="section">
            <div class="diagram-header">
                <h2>아키텍처 구조 다이어그램</h2>
                <div class="diagram-controls">
                    <button onclick="exportLayerCSV()">레이어별 컴포넌트 CSV 다운로드</button>
                    <button onclick="exportDiagramSVG()">다이어그램 SVG 내보내기</button>
                    <button onclick="exportDiagramPNG()">다이어그램 PNG 내보내기</button>
                </div>
            </div>
            <div class="diagram-container" id="architecture-diagram-container">
                
            <div class="architecture-diagram">
                <div class="layer-container">
                    
        <div class="layer controller-layer" style="background-color: #e3f2fd; border-color: #1976d2;">
            <div class="layer-header">
                <h3>Controller Layer (99개)</h3>
            </div>
            <div class="components-container">
                <div class="component">Product</div><div class="component">addProduct</div><div class="component">analyzeSearchResults</div><div class="component">applyPaging</div><div class="component">calculateAgeRange</div><div class="component">calculateStatusDistribution</div><div class="component">calculateTypeStatistics</div><div class="component">calculateUserStatistics</div><div class="component">cancelPayment</div><div class="component">createSampleOrder</div><div class="component">createUser</div><div class="component">createUser</div><div class="component">createUser</div><div class="component">createUser</div><div class="component">createUser</div><div class="component">deleteProduct</div><div class="component">deleteUser</div><div class="component">deleteUser</div><div class="component">destroy</div><div class="component">displayMainMenu</div><div class="component">displayProductDetail</div><div class="component">displayProductList</div><div class="component">doDelete</div><div class="component">doDelete</div><div class="component">doGet</div><div class="component">doGet</div><div class="component">doGet</div><div class="component">doPost</div><div class="component">doPost</div><div class="component">doPost</div><div class="component more-indicator">...외 69건</div>
            </div>
        </div>
        
                    <div class="layer-arrow">↓</div>
                    
        <div class="layer service-layer" style="background-color: #e1f5fe; border-color: #1565c0;">
            <div class="layer-header">
                <h3>Service Layer (346개)</h3>
            </div>
            <div class="components-container">
                <div class="component">0</div><div class="component">AnnotatedClass</div><div class="component">BaseService</div><div class="component">CommentHeavyClass</div><div class="component">ConcreteService</div><div class="component">CreditCardProcessor</div><div class="component">CustomAnnotation</div><div class="component">Date</div><div class="component">DeleteMapping</div><div class="component">Entry</div><div class="component">GET</div><div class="component">GenericClass</div><div class="component">GetMapping</div><div class="component">IllegalArgumentException</div><div class="component">MultipleClassFile</div><div class="component">NestedAnnotation</div><div class="component">POST</div><div class="component">PUT</div><div class="component">PostMapping</div><div class="component">Random</div><div class="component">RuntimeException</div><div class="component">StringBuilder</div><div class="component">SyntaxErrorClass</div><div class="component">User</div><div class="component">UserService</div><div class="component">add</div><div class="component">addAttribute</div><div class="component">after</div><div class="component">age</div><div class="component">anotherValidMethod</div><div class="component more-indicator">...외 316건</div>
            </div>
        </div>
        
                    <div class="layer-arrow">↓</div>
                    
        <div class="layer mapper-layer" style="background-color: #e8f5e8; border-color: #1b5e20;">
            <div class="layer-header">
                <h3>Mapper Layer (78개)</h3>
            </div>
            <div class="components-container">
                <div class="component">UnsupportedPatternDao</div><div class="component">UserDao</div><div class="component">UserDao</div><div class="component">buildBaseQuery</div><div class="component">buildJoinClause</div><div class="component">buildWhereClause</div><div class="component">createUser</div><div class="component">deleteUser</div><div class="component">deleteWithPlusOperatorMultiTable</div><div class="component">deleteWithStringFormat</div><div class="component">executeEnterpriseComplexQuery</div><div class="component">executeOracleDataWarehouseQuery</div><div class="component">existsByEmail</div><div class="component">existsByUsername</div><div class="component">findUserById</div><div class="component">findUsersByAdvancedCondition</div><div class="component">findUsersByConcatPattern</div><div class="component">findUsersByCondition</div><div class="component">findUsersByCondition</div><div class="component">findUsersByConditionAnsi</div><div class="component">findUsersByType</div><div class="component">generateAdvancedSampleUsers</div><div class="component">generateNewUser</div><div class="component">generateSampleResults</div><div class="component">generateSampleUsers</div><div class="component">generateSampleUsers</div><div class="component">generateUpdatedUser</div><div class="component">generateUserById</div><div class="component">generateUsersByType</div><div class="component">getActiveUserCount</div><div class="component more-indicator">...외 48건</div>
            </div>
        </div>
        
                    <div class="layer-arrow">↓</div>
                    
        <div class="layer model-layer" style="background-color: #f1f8ff; border-color: #0d47a1;">
            <div class="layer-header">
                <h3>Model Layer (101개)</h3>
            </div>
            <div class="components-container">
                <div class="component">OrderStatus</div><div class="component">Product</div><div class="component">User</div><div class="component">canAccessAdminFeatures</div><div class="component">canAccessPremiumFeatures</div><div class="component">canBeOrdered</div><div class="component">canTransitionTo</div><div class="component">getAccountAgeInDays</div><div class="component">getAddress</div><div class="component">getAge</div><div class="component">getAgeGroup</div><div class="component">getBrandId</div><div class="component">getCategoryDisplayName</div><div class="component">getCategoryId</div><div class="component">getCreatedDate</div><div class="component">getCreatedDate</div><div class="component">getDaysSinceCreated</div><div class="component">getDelYn</div><div class="component">getDeptName</div><div class="component">getDescription</div><div class="component">getDescription</div><div class="component">getDisplayName</div><div class="component">getDisplayName</div><div class="component">getEmail</div><div class="component">getFormattedPrice</div><div class="component">getId</div><div class="component">getLastUpdateInfo</div><div class="component">getMaskedEmail</div><div class="component">getMaskedPhone</div><div class="component">getName</div><div class="component more-indicator">...외 71건</div>
            </div>
        </div>
        
                    <div class="layer-arrow">↓</div>
                    
        <div class="layer etc-layer" style="background-color: #fafafa; border-color: #757575;">
            <div class="layer-header">
                <h3>Etc Layer (2개)</h3>
            </div>
            <div class="components-container">
                <div class="component">FinalHelperClass</div><div class="component">HelperClass</div>
            </div>
        </div>
        
                </div>
            </div>
            </div>
        </div>
        
        
        <div class="section">
            <h2>구성 요소 통계</h2>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>컴포넌트 타입</th>
                        <th>수량</th>
                        <th>설명</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>클래스</td>
                        <td>68개</td>
                        <td>Java 클래스 파일</td>
                    </tr>
                    <tr>
                        <td>테이블</td>
                        <td>26개</td>
                        <td>데이터베이스 테이블</td>
                    </tr>
                    <tr style="font-weight:bold;background-color:#e3f2fd;">
                        <td>전체</td>
                        <td>94개</td>
                        <td>총 컴포넌트 수</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="timestamp">
            Generated by SourceAnalyzer Architecture Reporter | 2025-09-19 17:47:57
        </div>
    </div>
    
    <script>
        
        // 오프라인 환경 지원을 위한 JavaScript
        // 외부 라이브러리 의존성 없이 순수 JavaScript로 구현
        
        // 레이어별 컴포넌트 데이터 (서버에서 주입)
        let layerComponentData = {};
        
        // 다이어그램 확대/축소 기능 (간단한 버전)
        function zoomDiagram(scale) {
            const diagram = document.querySelector('.architecture-diagram');
            if (diagram) {
                diagram.style.transform = `scale(${scale})`;
                diagram.style.transformOrigin = 'center center';
            }
        }
        
        // 레이어별 컴포넌트 CSV 내보내기
        function exportLayerCSV() {
            try {
                // 각 레이어별로 컴포넌트 수집
                const layers = ['controller', 'service', 'mapper', 'model'];
                let csvContent = 'Layer,Component_Name,Component_Type,File_Path\n';
                
                layers.forEach(layerName => {
                    const layerDiv = document.querySelector(`.${layerName}-layer`);
                    if (layerDiv) {
                        const components = layerDiv.querySelectorAll('.component');
                        components.forEach(component => {
                            const componentName = component.textContent.trim();
                            // "...외 N건" 형태는 제외
                            if (!componentName.includes('...외') && !componentName.includes('컴포넌트가 없습니다')) {
                                csvContent += `${layerName.toUpperCase()},${componentName},CLASS,\n`;
                            }
                        });
                    }
                });
                
                // CSV 파일 다운로드
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', '{project_name}_architecture_components_by_layer.csv');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                alert('레이어별 컴포넌트 CSV 파일이 다운로드되었습니다.');
            } catch (error) {
                console.error('CSV 내보내기 오류:', error);
                alert('CSV 내보내기 중 오류가 발생했습니다.');
            }
        }
        
        // 다이어그램 SVG 내보내기
        function exportDiagramSVG() {
            try {
                const diagramContainer = document.getElementById('architecture-diagram-container');
                if (!diagramContainer) {
                    alert('다이어그램을 찾을 수 없습니다.');
                    return;
                }
                
                // HTML을 SVG로 변환
                const svgContent = createSVGFromHTML(diagramContainer);
                const blob = new Blob([svgContent], { type: 'image/svg+xml;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', '{project_name}_architecture_diagram.svg');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                alert('다이어그램 SVG 파일이 다운로드되었습니다.');
            } catch (error) {
                console.error('SVG 내보내기 오류:', error);
                alert('SVG 내보내기 중 오류가 발생했습니다.');
            }
        }
        
        // 다이어그램 PNG 내보내기
        function exportDiagramPNG() {
            try {
                const diagramContainer = document.getElementById('architecture-diagram-container');
                if (!diagramContainer) {
                    alert('다이어그램을 찾을 수 없습니다.');
                    return;
                }
                
                // html2canvas 라이브러리 동적 로드 및 사용
                if (typeof html2canvas === 'undefined') {
                    const script = document.createElement('script');
                    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
                    script.onload = () => performPNGExport(diagramContainer);
                    script.onerror = () => {
                        // 오프라인 환경에서는 캔버스 기반 대안 사용
                        performCanvasPNGExport(diagramContainer);
                    };
                    document.head.appendChild(script);
                } else {
                    performPNGExport(diagramContainer);
                }
            } catch (error) {
                console.error('PNG 내보내기 오류:', error);
                alert('PNG 내보내기 중 오류가 발생했습니다.');
            }
        }
        
        // html2canvas를 사용한 PNG 내보내기
        function performPNGExport(container) {
            html2canvas(container, {
                backgroundColor: '#ffffff',
                scale: 2,
                useCORS: true,
                allowTaint: true,
                scrollX: 0,
                scrollY: 0,
                width: container.scrollWidth,
                height: container.scrollHeight
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = '{project_name}_architecture_diagram.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
                alert('다이어그램 PNG 파일이 다운로드되었습니다.');
            }).catch(err => {
                console.error('PNG 내보내기 실패:', err);
                alert('PNG 내보내기에 실패했습니다.');
            });
        }
        
        // 대안 캔버스 기반 PNG 내보내기 (오프라인 환경용)
        function performCanvasPNGExport(container) {
            // 간단한 캔버스 기반 렌더링 (텍스트만)
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 1200;
            canvas.height = 800;
            
            // 배경 설정
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 제목 그리기
            ctx.fillStyle = '#1976d2';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('시스템 아키텍처 다이어그램', canvas.width / 2, 50);
            
            // 레이어별 컴포넌트 텍스트 렌더링
            let yPos = 100;
            const layers = ['controller', 'service', 'mapper', 'model'];
            const layerColors = ['#e3f2fd', '#e1f5fe', '#e8f5e8', '#f1f8ff'];
            
            layers.forEach((layerName, index) => {
                const layerDiv = document.querySelector(`.${layerName}-layer`);
                if (layerDiv) {
                    // 레이어 박스 그리기
                    ctx.fillStyle = layerColors[index];
                    ctx.fillRect(100, yPos, canvas.width - 200, 120);
                    ctx.strokeStyle = '#1976d2';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(100, yPos, canvas.width - 200, 120);
                    
                    // 레이어 제목
                    ctx.fillStyle = '#1976d2';
                    ctx.font = 'bold 18px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(`${layerName.toUpperCase()} LAYER`, 120, yPos + 25);
                    
                    // 컴포넌트 나열
                    const components = layerDiv.querySelectorAll('.component');
                    let componentText = '';
                    let count = 0;
                    components.forEach(component => {
                        const name = component.textContent.trim();
                        if (!name.includes('...외') && !name.includes('컴포넌트가 없습니다') && count < 10) {
                            componentText += name + ', ';
                            count++;
                        }
                    });
                    if (componentText) {
                        componentText = componentText.slice(0, -2); // 마지막 쉼표 제거
                        if (count >= 10) componentText += '...';
                    }
                    
                    ctx.fillStyle = '#424242';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'left';
                    const words = componentText.split(' ');
                    let line = '';
                    let lineY = yPos + 50;
                    
                    for (let n = 0; n < words.length; n++) {
                        const testLine = line + words[n] + ' ';
                        const metrics = ctx.measureText(testLine);
                        const testWidth = metrics.width;
                        if (testWidth > canvas.width - 240 && n > 0) {
                            ctx.fillText(line, 120, lineY);
                            line = words[n] + ' ';
                            lineY += 15;
                        } else {
                            line = testLine;
                        }
                    }
                    ctx.fillText(line, 120, lineY);
                    
                    yPos += 150;
                }
            });
            
            // PNG 다운로드
            const link = document.createElement('a');
            link.download = 'architecture_diagram.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
            alert('다이어그램 PNG 파일이 다운로드되었습니다.');
        }
        
        // HTML을 SVG로 변환하는 함수
        function createSVGFromHTML(element) {
            const rect = element.getBoundingClientRect();
            const svgWidth = Math.max(rect.width, 1200);
            const svgHeight = Math.max(rect.height, 800);
            
            let svgContent = `<?xml version="1.0" encoding="UTF-8"?>
<svg width="${svgWidth}" height="${svgHeight}" xmlns="http://www.w3.org/2000/svg">
    <defs>
        <style>
            .layer-box { fill: #e3f2fd; stroke: #1976d2; stroke-width: 2; }
            .layer-text { font-family: Arial, sans-serif; font-size: 18px; font-weight: bold; fill: #1976d2; }
            .component-text { font-family: Arial, sans-serif; font-size: 12px; fill: #424242; }
        </style>
    </defs>
    <rect width="100%" height="100%" fill="white"/>
    <text x="${svgWidth/2}" y="30" text-anchor="middle" font-family="Arial" font-size="24" font-weight="bold" fill="#1976d2">시스템 아키텍처 다이어그램</text>
`;
            
            let yPos = 80;
            const layers = ['controller', 'service', 'mapper', 'model'];
            const layerColors = ['#e3f2fd', '#e1f5fe', '#e8f5e8', '#f1f8ff'];
            
            layers.forEach((layerName, index) => {
                const layerDiv = document.querySelector(`.${layerName}-layer`);
                if (layerDiv) {
                    // 레이어 박스
                    svgContent += `<rect x="50" y="${yPos}" width="${svgWidth-100}" height="120" fill="${layerColors[index]}" stroke="#1976d2" stroke-width="2"/>`;
                    
                    // 레이어 제목
                    svgContent += `<text x="70" y="${yPos + 25}" class="layer-text">${layerName.toUpperCase()} LAYER</text>`;
                    
                    // 컴포넌트 텍스트
                    const components = layerDiv.querySelectorAll('.component');
                    let componentText = '';
                    let count = 0;
                    components.forEach(component => {
                        const name = component.textContent.trim();
                        if (!name.includes('...외') && !name.includes('컴포넌트가 없습니다') && count < 15) {
                            componentText += name + ', ';
                            count++;
                        }
                    });
                    if (componentText) {
                        componentText = componentText.slice(0, -2);
                        if (count >= 15) componentText += '...';
                    }
                    
                    // 텍스트를 여러 줄로 분할
                    const words = componentText.split(' ');
                    let line = '';
                    let lineY = yPos + 50;
                    const maxWidth = svgWidth - 140;
                    
                    for (let n = 0; n < words.length; n++) {
                        const testLine = line + words[n] + ' ';
                        if (testLine.length * 7 > maxWidth && n > 0) { // 대략적인 문자 폭 계산
                            svgContent += `<text x="70" y="${lineY}" class="component-text">${line.trim()}</text>`;
                            line = words[n] + ' ';
                            lineY += 15;
                        } else {
                            line = testLine;
                        }
                    }
                    if (line.trim()) {
                        svgContent += `<text x="70" y="${lineY}" class="component-text">${line.trim()}</text>`;
                    }
                    
                    yPos += 150;
                }
            });
            
            svgContent += '</svg>';
            return svgContent;
        }
        
        // 다이어그램 초기화
        document.addEventListener('DOMContentLoaded', function() {
            // 반응형 처리
            const diagram = document.querySelector('.architecture-diagram');
            if (diagram) {
                diagram.style.maxWidth = '100%';
                diagram.style.height = 'auto';
            }
        });
        
        // 키보드 단축키 지원
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case '=':
                    case '+':
                        e.preventDefault();
                        zoomDiagram(1.2);
                        break;
                    case '-':
                        e.preventDefault();
                        zoomDiagram(0.8);
                        break;
                    case '0':
                        e.preventDefault();
                        zoomDiagram(1);
                        break;
                }
            }
        });
        
    </script>
</body>
</html>