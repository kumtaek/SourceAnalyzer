# ì˜í–¥í‰ê°€ í™œìš© ê°€ì´ë“œ

## ë¬¸ì„œ ì •ë³´
- **ì‘ì„±ì¼**: 2025-09-19
- **ë²„ì „**: v1.0
- **ëª©ì **: êµ¬ì¶•ëœ ë©”íƒ€ë°ì´í„°ë¥¼ í™œìš©í•œ ì˜í–¥í‰ê°€ ìˆ˜í–‰ ë°©ë²•

## ì˜í–¥í‰ê°€ ìš”êµ¬ì‚¬í•­

```mermaid
graph TD
    subgraph "í•µì‹¬ ìš”êµ¬ì‚¬í•­ (ê³ ìœ„í—˜)"
        REQ001["REQ001: ì˜í–¥í‰ê°€ ì •í™•ì„±<br/>100% ì •í™•í•œ ê²°ê³¼<br/>ê²€ì¦: í…ŒìŠ¤íŠ¸"]
        REQ003["REQ003: ì „ì²´ ì¶”ì <br/>Frontendâ†’DB ì™„ì „ ì¶”ì <br/>ê²€ì¦: ê²€ì‚¬"]
    end
    
    subgraph "ì„±ëŠ¥ ìš”êµ¬ì‚¬í•­ (ì¤‘ìœ„í—˜)"
        REQ002["REQ002: ì‹¤ì‹œê°„ ì‘ë‹µ<br/>5ì´ˆ ë‚´ ì‘ë‹µ<br/>ê²€ì¦: ì‹¤ì¦"]
    end
    
    subgraph "ì‚¬ìš©ì„± ìš”êµ¬ì‚¬í•­ (ì €ìœ„í—˜)"
        REQ004["REQ004: ì‚¬ìš©ì ì¹œí™”ì„±<br/>ë¹„ì „ë¬¸ê°€ë„ ì‚¬ìš© ê°€ëŠ¥<br/>ê²€ì¦: ë¶„ì„"]
    end
    
    subgraph "ì‹œìŠ¤í…œ ì»´í¬ë„ŒíŠ¸"
        ENGINE["ì˜í–¥í‰ê°€ ì—”ì§„"]
        DATABASE["ë©”íƒ€ë°ì´í„°ë² ì´ìŠ¤"]
        REPORT["ë¦¬í¬íŠ¸ ìƒì„±ê¸°"]
    end
    
    ENGINE --> REQ001
    ENGINE --> REQ002
    DATABASE --> REQ003
    REPORT --> REQ004
    
    REQ001 -.-> REQ003
    REQ002 -.-> REQ004
    
    style REQ001 fill:#ffcdd2
    style REQ003 fill:#ffcdd2
    style REQ002 fill:#fff3e0
    style REQ004 fill:#e8f5e8
    style ENGINE fill:#e3f2fd
    style DATABASE fill:#e3f2fd
    style REPORT fill:#e3f2fd
```

## 1. ì˜í–¥í‰ê°€ ê°œìš”

### 1.1 ì˜í–¥í‰ê°€ ëª©ì 
- ë³€ê²½ ì‚¬í•­ì´ ì‹œìŠ¤í…œì— ë¯¸ì¹˜ëŠ” ì˜í–¥ ë²”ìœ„ íŒŒì•…
- í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ì‹ë³„ ë° ìš°ì„ ìˆœìœ„ ê²°ì •
- ë¦¬ìŠ¤í¬ í‰ê°€ ë° ë³€ê²½ ê³„íš ìˆ˜ë¦½

### 1.2 ì˜í–¥í‰ê°€ ìœ í˜•

```mermaid
graph TD
    A["ì˜í–¥í‰ê°€ ìœ í˜•"] --> B["í…Œì´ë¸” ë³€ê²½ ì˜í–¥í‰ê°€"]
    A --> C["API ë³€ê²½ ì˜í–¥í‰ê°€"]
    A --> D["í´ë˜ìŠ¤/ë©”ì„œë“œ ë³€ê²½ ì˜í–¥í‰ê°€"]
    A --> E["ì¿¼ë¦¬ ë³€ê²½ ì˜í–¥í‰ê°€"]
    
    B --> F["ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ì¿¼ë¦¬<br/>ì˜í–¥ë°›ëŠ” í™”ë©´"]
    C --> G["í˜¸ì¶œí•˜ëŠ” ëª¨ë“  í™”ë©´<br/>ê´€ë ¨ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§"]
    D --> H["ì˜ì¡´í•˜ëŠ” ëª¨ë“  í´ë˜ìŠ¤<br/>ê´€ë ¨ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤"]
    E --> I["ê´€ë ¨ í…Œì´ë¸”<br/>ì˜í–¥ë°›ëŠ” ê¸°ëŠ¥"]
    
    style A fill:#e3f2fd
    style F fill:#c8e6c9
    style G fill:#c8e6c9
    style H fill:#c8e6c9
    style I fill:#c8e6c9
```

## 2. í…Œì´ë¸” ë³€ê²½ ì˜í–¥í‰ê°€

### 2.1 í…Œì´ë¸” ì˜í–¥í‰ê°€ í”Œë¡œìš°

```mermaid
flowchart TD
    A["ë³€ê²½ ëŒ€ìƒ í…Œì´ë¸”"] --> B["ì§ì ‘ ì‚¬ìš© ì¿¼ë¦¬ ì¡°íšŒ"]
    B --> C["ì¿¼ë¦¬ ì‚¬ìš© ë©”ì„œë“œ ì¡°íšŒ"]
    C --> D["ë©”ì„œë“œ í˜¸ì¶œ ì²´ì¸ ì¶”ì "]
    D --> E["API ì—”ë“œí¬ì¸íŠ¸ ì‹ë³„"]
    E --> F["Frontend í™”ë©´ ì‹ë³„"]
    F --> G["ì˜í–¥ ë²”ìœ„ ë¦¬í¬íŠ¸ ìƒì„±"]
    
    style A fill:#ffebee
    style G fill:#c8e6c9
```

### 2.2 í…Œì´ë¸” ì˜í–¥í‰ê°€ êµ¬í˜„

```python
def analyze_table_impact(table_name: str, project_id: int) -> dict:
    """í…Œì´ë¸” ë³€ê²½ ì˜í–¥í‰ê°€"""
    
    impact_result = {
        'target_table': table_name,
        'direct_queries': [],
        'affected_methods': [],
        'affected_apis': [],
        'affected_frontends': [],
        'join_related_tables': [],
        'impact_level': 'LOW'
    }
    
    # 1. ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ì¿¼ë¦¬ ì¡°íšŒ
    direct_queries = find_queries_using_table(table_name, project_id)
    impact_result['direct_queries'] = direct_queries
    
    # 2. ì¿¼ë¦¬ë¥¼ í˜¸ì¶œí•˜ëŠ” ë©”ì„œë“œ ì¡°íšŒ
    affected_methods = []
    for query in direct_queries:
        methods = find_methods_calling_query(query['component_id'], project_id)
        affected_methods.extend(methods)
    impact_result['affected_methods'] = affected_methods
    
    # 3. ë©”ì„œë“œ í˜¸ì¶œ ì²´ì¸ì„ í†µí•œ API ì¶”ì 
    affected_apis = []
    for method in affected_methods:
        apis = trace_method_to_apis(method['component_id'], project_id)
        affected_apis.extend(apis)
    impact_result['affected_apis'] = affected_apis
    
    # 4. APIë¥¼ í˜¸ì¶œí•˜ëŠ” Frontend ì¡°íšŒ
    affected_frontends = []
    for api in affected_apis:
        frontends = find_frontends_calling_api(api['component_id'], project_id)
        affected_frontends.extend(frontends)
    impact_result['affected_frontends'] = affected_frontends
    
    # 5. ì¡°ì¸ ê´€ê³„ í…Œì´ë¸” ì¡°íšŒ
    join_tables = find_join_related_tables(table_name, project_id)
    impact_result['join_related_tables'] = join_tables
    
    # 6. ì˜í–¥ ìˆ˜ì¤€ ê²°ì •
    impact_result['impact_level'] = determine_impact_level(impact_result)
    
    return impact_result

def find_queries_using_table(table_name: str, project_id: int) -> List[dict]:
    """í…Œì´ë¸”ì„ ì‚¬ìš©í•˜ëŠ” ì¿¼ë¦¬ ì¡°íšŒ"""
    
    query = """
    SELECT DISTINCT 
        q.component_id,
        q.component_name,
        q.component_type,
        q.layer,
        f.file_name,
        f.file_path
    FROM components q
    INNER JOIN relationships r ON q.component_id = r.src_id
    INNER JOIN components t ON r.dst_id = t.component_id
    INNER JOIN files f ON q.file_id = f.file_id
    WHERE q.project_id = ?
      AND q.component_type IN ('SQL_SELECT', 'SQL_INSERT', 'SQL_UPDATE', 'SQL_DELETE', 'QUERY')
      AND r.rel_type = 'USE_TABLE'
      AND t.component_type = 'TABLE'
      AND UPPER(t.component_name) = UPPER(?)
      AND q.del_yn = 'N'
      AND r.del_yn = 'N'
      AND t.del_yn = 'N'
    ORDER BY q.component_name
    """
    
    return execute_query(query, [project_id, table_name])
```

### 2.3 ì˜í–¥ ìˆ˜ì¤€ ê²°ì •

```python
def determine_impact_level(impact_result: dict) -> str:
    """ì˜í–¥ ìˆ˜ì¤€ ê²°ì •"""
    
    # ì˜í–¥ë°›ëŠ” ì»´í¬ë„ŒíŠ¸ ìˆ˜ ê³„ì‚°
    query_count = len(impact_result['direct_queries'])
    method_count = len(impact_result['affected_methods'])
    api_count = len(impact_result['affected_apis'])
    frontend_count = len(impact_result['affected_frontends'])
    join_table_count = len(impact_result['join_related_tables'])
    
    total_impact_score = (
        query_count * 1 +
        method_count * 2 +
        api_count * 3 +
        frontend_count * 4 +
        join_table_count * 2
    )
    
    # ì˜í–¥ ìˆ˜ì¤€ ë¶„ë¥˜
    if total_impact_score >= 50:
        return 'CRITICAL'
    elif total_impact_score >= 20:
        return 'HIGH'
    elif total_impact_score >= 5:
        return 'MEDIUM'
    else:
        return 'LOW'
```

## 3. API ë³€ê²½ ì˜í–¥í‰ê°€

### 3.1 API ì˜í–¥í‰ê°€ ì‹œí€€ìŠ¤

```mermaid
sequenceDiagram
    participant U as ì‚¬ìš©ì
    participant A as ì˜í–¥í‰ê°€ê¸°
    participant M as ë©”íƒ€ë°ì´í„°DB
    participant R as ë¦¬í¬íŠ¸ìƒì„±ê¸°
    
    U->>A: API ë³€ê²½ ì˜í–¥í‰ê°€ ìš”ì²­
    A->>M: API í˜¸ì¶œ Frontend ì¡°íšŒ
    M-->>A: Frontend íŒŒì¼ ëª©ë¡
    A->>M: API êµ¬í˜„ ë©”ì„œë“œ ì¡°íšŒ
    M-->>A: Controller/Service ë©”ì„œë“œ
    A->>M: ë©”ì„œë“œ í˜¸ì¶œ ì²´ì¸ ì¡°íšŒ
    M-->>A: ì „ì²´ í˜¸ì¶œ ê²½ë¡œ
    A->>R: ì˜í–¥ ë²”ìœ„ ë¦¬í¬íŠ¸ ìƒì„±
    R-->>U: ìƒì„¸ ì˜í–¥í‰ê°€ ë¦¬í¬íŠ¸
```

### 3.2 API ì˜í–¥í‰ê°€ êµ¬í˜„

```python
def analyze_api_impact(api_url: str, http_method: str, project_id: int) -> dict:
    """API ë³€ê²½ ì˜í–¥í‰ê°€"""
    
    impact_result = {
        'target_api': f"{http_method} {api_url}",
        'calling_frontends': [],
        'implementation_chain': [],
        'affected_tables': [],
        'related_apis': [],
        'test_scenarios': []
    }
    
    # 1. API ì»´í¬ë„ŒíŠ¸ ì¡°íšŒ
    api_component = find_api_component(api_url, http_method, project_id)
    if not api_component:
        impact_result['error'] = 'API not found'
        return impact_result
    
    # 2. APIë¥¼ í˜¸ì¶œí•˜ëŠ” Frontend ì¡°íšŒ
    calling_frontends = find_frontends_calling_api(
        api_component['component_id'], project_id
    )
    impact_result['calling_frontends'] = calling_frontends
    
    # 3. API êµ¬í˜„ ì²´ì¸ ì¶”ì  (Controller -> Service -> Repository)
    implementation_chain = trace_api_implementation_chain(
        api_component['component_id'], project_id
    )
    impact_result['implementation_chain'] = implementation_chain
    
    # 4. ì˜í–¥ë°›ëŠ” í…Œì´ë¸” ì¡°íšŒ
    affected_tables = find_tables_in_implementation_chain(
        implementation_chain, project_id
    )
    impact_result['affected_tables'] = affected_tables
    
    # 5. ê´€ë ¨ API ì¡°íšŒ (ê°™ì€ í…Œì´ë¸” ì‚¬ìš©)
    related_apis = find_related_apis_by_tables(
        affected_tables, project_id, exclude_api_id=api_component['component_id']
    )
    impact_result['related_apis'] = related_apis
    
    # 6. í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±
    test_scenarios = generate_test_scenarios(impact_result)
    impact_result['test_scenarios'] = test_scenarios
    
    return impact_result

def trace_api_implementation_chain(api_component_id: int, project_id: int) -> List[dict]:
    """API êµ¬í˜„ ì²´ì¸ ì¶”ì """
    
    chain = []
    current_id = api_component_id
    
    # ì¬ê·€ì ìœ¼ë¡œ í˜¸ì¶œ ê´€ê³„ë¥¼ ë”°ë¼ê°€ë©° êµ¬í˜„ ì²´ì¸ êµ¬ì„±
    while True:
        # í˜„ì¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ í˜¸ì¶œí•˜ëŠ” ë‹¤ìŒ ì»´í¬ë„ŒíŠ¸ ì¡°íšŒ
        next_component = find_next_in_call_chain(current_id, project_id)
        
        if not next_component:
            break
        
        chain.append(next_component)
        current_id = next_component['component_id']
        
        # ë¬´í•œ ë£¨í”„ ë°©ì§€
        if len(chain) > 10:
            break
    
    return chain
```

## 4. í´ë˜ìŠ¤/ë©”ì„œë“œ ë³€ê²½ ì˜í–¥í‰ê°€

### 4.1 í´ë˜ìŠ¤ ì˜ì¡´ì„± ë¶„ì„

```mermaid
graph TD
    A["ë³€ê²½ ëŒ€ìƒ í´ë˜ìŠ¤"] --> B["ì§ì ‘ ì˜ì¡´ í´ë˜ìŠ¤"]
    A --> C["ìƒì† ê´€ê³„ í´ë˜ìŠ¤"]
    A --> D["ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ í´ë˜ìŠ¤"]
    
    B --> E["ê°„ì ‘ ì˜ì¡´ í´ë˜ìŠ¤"]
    C --> E
    D --> E
    
    E --> F["ì „ì²´ ì˜ì¡´ì„± íŠ¸ë¦¬"]
    F --> G["ì˜í–¥ ë²”ìœ„ ê³„ì‚°"]
    
    style A fill:#ffebee
    style G fill:#c8e6c9
```

### 4.2 ë©”ì„œë“œ ë³€ê²½ ì˜í–¥í‰ê°€

```python
def analyze_method_impact(class_name: str, method_name: str, project_id: int) -> dict:
    """ë©”ì„œë“œ ë³€ê²½ ì˜í–¥í‰ê°€"""
    
    impact_result = {
        'target_method': f"{class_name}.{method_name}",
        'direct_callers': [],
        'indirect_callers': [],
        'affected_apis': [],
        'affected_tests': [],
        'dependency_depth': 0
    }
    
    # 1. ëŒ€ìƒ ë©”ì„œë“œ ì»´í¬ë„ŒíŠ¸ ì¡°íšŒ
    method_component = find_method_component(class_name, method_name, project_id)
    if not method_component:
        impact_result['error'] = 'Method not found'
        return impact_result
    
    # 2. ì§ì ‘ í˜¸ì¶œì ì¡°íšŒ
    direct_callers = find_direct_method_callers(
        method_component['component_id'], project_id
    )
    impact_result['direct_callers'] = direct_callers
    
    # 3. ê°„ì ‘ í˜¸ì¶œì ì¡°íšŒ (ì¬ê·€ì  ì¶”ì )
    indirect_callers = find_indirect_method_callers(
        method_component['component_id'], project_id, max_depth=5
    )
    impact_result['indirect_callers'] = indirect_callers
    impact_result['dependency_depth'] = calculate_max_dependency_depth(indirect_callers)
    
    # 4. ì˜í–¥ë°›ëŠ” API ì¡°íšŒ
    all_callers = direct_callers + indirect_callers
    affected_apis = find_apis_from_method_chain(all_callers, project_id)
    impact_result['affected_apis'] = affected_apis
    
    # 5. ê´€ë ¨ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì¶”ì •
    affected_tests = estimate_affected_test_cases(
        class_name, method_name, all_callers, project_id
    )
    impact_result['affected_tests'] = affected_tests
    
    return impact_result

def find_indirect_method_callers(method_id: int, project_id: int, 
                               max_depth: int = 5) -> List[dict]:
    """ê°„ì ‘ í˜¸ì¶œì ì¬ê·€ ì¡°íšŒ"""
    
    all_callers = []
    visited = set()
    
    def trace_callers_recursive(current_method_id: int, depth: int):
        if depth > max_depth or current_method_id in visited:
            return
        
        visited.add(current_method_id)
        
        # í˜„ì¬ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ë©”ì„œë“œë“¤ ì¡°íšŒ
        callers = find_direct_method_callers(current_method_id, project_id)
        
        for caller in callers:
            caller['depth'] = depth
            all_callers.append(caller)
            
            # ì¬ê·€ í˜¸ì¶œ
            trace_callers_recursive(caller['component_id'], depth + 1)
    
    # ì´ˆê¸° í˜¸ì¶œ
    trace_callers_recursive(method_id, 1)
    
    return all_callers
```

## 5. ì˜í–¥í‰ê°€ ë¦¬í¬íŠ¸ ìƒì„±

### 5.1 ë¦¬í¬íŠ¸ êµ¬ì¡°

```mermaid
classDiagram
    class ImpactReport {
        +targetComponent
        +changeType
        +impactLevel
        +directImpacts
        +indirectImpacts
        +testScenarios
        +generateHtmlReport()
        +generateExcelReport()
    }
    
    class Component {
        +componentType
        +componentName
        +layer
        +filePath
        +impactScore
    }
    
    class TestScenario {
        +scenarioType
        +description
        +priority
        +testSteps
    }
    
    ImpactReport --> Component
    ImpactReport --> TestScenario
```

### 5.2 HTML ë¦¬í¬íŠ¸ ìƒì„±

```python
def generate_impact_html_report(impact_result: dict, output_path: str) -> str:
    """ì˜í–¥í‰ê°€ HTML ë¦¬í¬íŠ¸ ìƒì„±"""
    
    html_template = """
    <!DOCTYPE html>
    <html>
    <head>
        <title>ì˜í–¥í‰ê°€ ë¦¬í¬íŠ¸ - {target}</title>
        <meta charset="utf-8">
        <style>
            body {{ font-family: 'Malgun Gothic', sans-serif; margin: 20px; }}
            .header {{ background: #2196F3; color: white; padding: 20px; border-radius: 5px; }}
            .impact-level {{ 
                display: inline-block; padding: 5px 15px; border-radius: 3px; 
                color: white; font-weight: bold;
            }}
            .level-critical {{ background: #f44336; }}
            .level-high {{ background: #ff9800; }}
            .level-medium {{ background: #ffeb3b; color: black; }}
            .level-low {{ background: #4caf50; }}
            .section {{ margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }}
            .component-list {{ max-height: 300px; overflow-y: auto; }}
            .component-item {{ 
                padding: 8px; margin: 5px 0; background: #f5f5f5; 
                border-left: 4px solid #2196F3; 
            }}
            .layer-tag {{ 
                display: inline-block; padding: 2px 8px; border-radius: 3px; 
                font-size: 12px; color: white; margin-right: 5px;
            }}
            .layer-controller {{ background: #e91e63; }}
            .layer-service {{ background: #9c27b0; }}
            .layer-repository {{ background: #673ab7; }}
            .layer-query {{ background: #3f51b5; }}
            .layer-table {{ background: #009688; }}
        </style>
    </head>
    <body>
        <div class="header">
            <h1>ì˜í–¥í‰ê°€ ë¦¬í¬íŠ¸</h1>
            <p><strong>ëŒ€ìƒ:</strong> {target}</p>
            <p><strong>ë¶„ì„ì¼ì‹œ:</strong> {analysis_date}</p>
            <p><strong>ì˜í–¥ ìˆ˜ì¤€:</strong> 
                <span class="impact-level level-{impact_level_lower}">{impact_level}</span>
            </p>
        </div>
        
        <div class="section">
            <h2>ğŸ“Š ì˜í–¥ ìš”ì•½</h2>
            <table border="1" style="width: 100%; border-collapse: collapse;">
                <tr>
                    <th>êµ¬ë¶„</th>
                    <th>ì˜í–¥ë°›ëŠ” ì»´í¬ë„ŒíŠ¸ ìˆ˜</th>
                    <th>ì£¼ìš” ì˜í–¥ ì˜ì—­</th>
                </tr>
                {summary_rows}
            </table>
        </div>
        
        <div class="section">
            <h2>ğŸ” ì§ì ‘ ì˜í–¥ ì»´í¬ë„ŒíŠ¸</h2>
            <div class="component-list">
                {direct_components}
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸŒ ê°„ì ‘ ì˜í–¥ ì»´í¬ë„ŒíŠ¸</h2>
            <div class="component-list">
                {indirect_components}
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ§ª ê¶Œì¥ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤</h2>
            {test_scenarios}
        </div>
        
        <div class="section">
            <h2>âš ï¸ ì£¼ì˜ì‚¬í•­ ë° ê¶Œì¥ì‚¬í•­</h2>
            {recommendations}
        </div>
    </body>
    </html>
    """
    
    # í…œí”Œë¦¿ ë°ì´í„° ì¤€ë¹„
    template_data = prepare_html_template_data(impact_result)
    
    # HTML ìƒì„±
    html_content = html_template.format(**template_data)
    
    # íŒŒì¼ ì €ì¥
    with open(output_path, 'w', encoding='utf-8') as f:
        f.write(html_content)
    
    return output_path
```

## 6. ì‹¤ì‹œê°„ ì˜í–¥í‰ê°€ API

### 6.1 ì˜í–¥í‰ê°€ API êµ¬ì¡°

```mermaid
sequenceDiagram
    participant C as Client
    participant A as Impact API
    participant E as Impact Engine
    participant M as MetaDB
    participant R as Report Generator
    
    C->>A: POST /api/impact-analysis
    A->>E: ì˜í–¥í‰ê°€ ìš”ì²­
    E->>M: ê´€ë ¨ ì»´í¬ë„ŒíŠ¸ ì¡°íšŒ
    M-->>E: ë©”íƒ€ë°ì´í„° ë°˜í™˜
    E->>E: ì˜í–¥ ë²”ìœ„ ê³„ì‚°
    E->>R: ë¦¬í¬íŠ¸ ìƒì„± ìš”ì²­
    R-->>E: ë¦¬í¬íŠ¸ URL
    E-->>A: ì˜í–¥í‰ê°€ ê²°ê³¼
    A-->>C: JSON ì‘ë‹µ
```

### 6.2 ì˜í–¥í‰ê°€ API êµ¬í˜„

```python
from flask import Flask, request, jsonify
from datetime import datetime

app = Flask(__name__)

@app.route('/api/impact-analysis', methods=['POST'])
def analyze_impact():
    """ì˜í–¥í‰ê°€ API"""
    
    try:
        # ìš”ì²­ ë°ì´í„° íŒŒì‹±
        data = request.json
        target_type = data.get('target_type')  # table, api, method, query
        target_name = data.get('target_name')
        project_id = data.get('project_id')
        
        # ì˜í–¥í‰ê°€ ìˆ˜í–‰
        if target_type == 'table':
            result = analyze_table_impact(target_name, project_id)
        elif target_type == 'api':
            api_url = data.get('api_url')
            http_method = data.get('http_method', 'GET')
            result = analyze_api_impact(api_url, http_method, project_id)
        elif target_type == 'method':
            class_name = data.get('class_name')
            method_name = data.get('method_name')
            result = analyze_method_impact(class_name, method_name, project_id)
        else:
            return jsonify({'error': 'Invalid target_type'}), 400
        
        # ë¦¬í¬íŠ¸ ìƒì„±
        report_path = generate_impact_html_report(
            result, 
            f"./reports/impact_{target_type}_{datetime.now().strftime('%Y%m%d_%H%M%S')}.html"
        )
        
        # ì‘ë‹µ ìƒì„±
        response = {
            'success': True,
            'target': f"{target_type}: {target_name}",
            'impact_level': result.get('impact_level', 'UNKNOWN'),
            'analysis_time': datetime.now().isoformat(),
            'report_url': report_path,
            'summary': generate_impact_summary(result)
        }
        
        return jsonify(response)
        
    except Exception as e:
        return jsonify({
            'success': False,
            'error': str(e)
        }), 500

def generate_impact_summary(impact_result: dict) -> dict:
    """ì˜í–¥í‰ê°€ ìš”ì•½ ìƒì„±"""
    
    summary = {
        'total_affected_components': 0,
        'by_layer': {},
        'critical_paths': [],
        'recommendations': []
    }
    
    # ë ˆì´ì–´ë³„ ì˜í–¥ ì»´í¬ë„ŒíŠ¸ ì§‘ê³„
    all_components = []
    
    # ê° ì˜í–¥í‰ê°€ ê²°ê³¼ì—ì„œ ì»´í¬ë„ŒíŠ¸ ì¶”ì¶œ
    for key, components in impact_result.items():
        if isinstance(components, list) and components:
            all_components.extend(components)
    
    # ë ˆì´ì–´ë³„ ì§‘ê³„
    layer_counts = {}
    for comp in all_components:
        layer = comp.get('layer', 'UNKNOWN')
        layer_counts[layer] = layer_counts.get(layer, 0) + 1
    
    summary['by_layer'] = layer_counts
    summary['total_affected_components'] = len(all_components)
    
    # ê¶Œì¥ì‚¬í•­ ìƒì„±
    impact_level = impact_result.get('impact_level', 'LOW')
    summary['recommendations'] = generate_recommendations_by_impact_level(impact_level)
    
    return summary

if __name__ == '__main__':
    app.run(debug=True, port=5000)
```

## 7. ì„±ëŠ¥ ìµœì í™” ë° í™•ì¥ì„±

### 7.1 ì„±ëŠ¥ ìµœì í™” ë°©ì•ˆ

```python
def optimize_impact_analysis():
    """ì˜í–¥í‰ê°€ ì„±ëŠ¥ ìµœì í™”"""
    
    # 1. ì¸ë±ìŠ¤ ìµœì í™”
    create_impact_analysis_indexes()
    
    # 2. ì¿¼ë¦¬ ìºì‹±
    setup_query_cache()
    
    # 3. ê²°ê³¼ ìºì‹±
    setup_result_cache()
    
    # 4. ë³‘ë ¬ ì²˜ë¦¬
    setup_parallel_processing()

def create_impact_analysis_indexes():
    """ì˜í–¥í‰ê°€ìš© ì¸ë±ìŠ¤ ìƒì„±"""
    
    indexes = [
        "CREATE INDEX IF NOT EXISTS idx_rel_src_type_del ON relationships(src_id, rel_type, del_yn)",
        "CREATE INDEX IF NOT EXISTS idx_rel_dst_type_del ON relationships(dst_id, rel_type, del_yn)",
        "CREATE INDEX IF NOT EXISTS idx_comp_type_name ON components(component_type, component_name, del_yn)",
        "CREATE INDEX IF NOT EXISTS idx_comp_layer_type ON components(layer, component_type, del_yn)"
    ]
    
    for index_sql in indexes:
        execute_query(index_sql)
```

---

## ë‹¤ìŒ ë‹¨ê³„
- [08_ë¦¬í¬íŠ¸_ìƒì„±_êµ¬í˜„ì„œ.md](08_ë¦¬í¬íŠ¸_ìƒì„±_êµ¬í˜„ì„œ.md): ë¶„ì„ ê²°ê³¼ ë¦¬í¬íŠ¸ ìƒì„±
- [10_ì„±ëŠ¥_ìµœì í™”_ê°€ì´ë“œ.md](10_ì„±ëŠ¥_ìµœì í™”_ê°€ì´ë“œ.md): ì‹œìŠ¤í…œ ì„±ëŠ¥ ìµœì í™” ë°©ì•ˆ
