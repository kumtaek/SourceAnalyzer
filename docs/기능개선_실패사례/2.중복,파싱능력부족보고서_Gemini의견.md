# 검토 의견: '중복,파싱능력부족보고서.md' 기반 개선사항 분석

## 1. 개요
요청하신 `docs/기능개선/중복,파싱능력부족보고서.md` 내용과 현재 소스 코드를 비교 분석하여, **'프론트-자바-XML-쿼리-테이블-컬럼' 간의 관계를 누락 없이 도출**하는 최우선 목표에 맞춰 검토 의견을 정리했습니다.

보고서의 내용은 매우 상세하며, 대부분 시스템의 정확도를 높이는 데 필수적인 항목들입니다. 아래는 각 항목에 대한 목표 연관성 및 개선 우선순위 의견입니다.

## 2. 세부 검토 결과

### 2.1. 파싱 능력 부족 문제 (누락과 직결)

#### 가. MyBatis 동적 SQL 내부 테이블 누락 (`<if>`, `<foreach>`)
- **문제점**: 보고서에서 지적한 대로, `<if>`나 `<foreach>` 같은 조건문/반복문 안에만 존재하는 테이블이나 컬럼 정보를 누락할 위험이 매우 큽니다.
- **현재 소스 분석**: 현재 파서는 동적 SQL 태그를 단순히 제거하거나 기본적인 패턴만 감지할 가능성이 높으며, 모든 논리적 분기 경로를 탐색하여 내부에 사용된 모든 테이블/컬럼을 수집하는 기능은 부족해 보입니다.
- **검토 의견**: **[필수 개선]**. 실제 애플리케이션의 많은 핵심 쿼리가 동적 SQL로 작성됩니다. 이 기능의 부재는 테이블 및 컬럼 정보 누락에 치명적이므로, 모든 분기 경로를 순회하여 정보를 수집하도록 파서 로직을 강화하는 것이 가장 시급합니다.

#### 나. `<include>` 태그 미지원 (SQL 조각 누락)
- **문제점**: 공통 SQL 구문을 `<sql>` 태그로 정의하고 `<include>`로 참조하는 경우, 참조된 SQL 조각 전체를 누락하게 됩니다.
- **현재 소스 분석**: 보고서 내용대로, 현재 XML 파서가 `refid`를 해석하여 다른 `<sql>` 정의를 가져와서 현재 쿼리와 합치는 기능이 구현되지 않았을 가능성이 높습니다.
- **검토 의견**: **[필수 개선]**. 이는 MyBatis의 핵심 기능 중 하나로, 지원되지 않으면 상당수의 테이블, 컬럼, 조인 관계가 누락됩니다. XML 문서 내에서, 또는 여러 파일에 걸쳐 `<sql>` 조각을 찾고 해석하는 기능 구현이 시급합니다.

#### 다. Java 내 동적 SQL 생성 패턴 미지원 (`+` 연산자, `String.format`)
- **문제점**: Java 코드에서 문자열 연산을 통해 동적으로 SQL을 만드는 경우, 현재 분석기가 이를 추적하지 못해 쿼리 자체를 인지하지 못합니다.
- **현재 소스 분석**: `StringBuilder` 외에, 변수와 문자열을 `+`로 연결하거나 `String.format`을 사용하는 패턴에 대한 분석 기능은 구현되지 않은 것으로 보입니다. 이는 고도의 정적 분석 기술이 필요합니다.
- **검토 의견**: **[필수 개선]**. XML 매퍼만큼이나 Java 코드에서 직접 생성하는 SQL도 많으므로, 이 부분의 누락은 전체 완성도를 크게 저해합니다. 우선적으로 `+` 연산자를 사용한 단순 문자열 결합 패턴부터 지원하고, 점진적으로 `String.format` 등으로 지원을 확대해야 합니다.

#### 라. MERGE  INTO 구문 분석 미흡
- **문제점**: `MERGE` 구문 자체는 인식하더라도, `USING` 절의 테이블과 `ON` 절의 조인 조건을 제대로 분석하지 못하면 관계 정보가 누락됩니다.
- **현재 소스 분석**: SQL 파서가 `MERGE` 구문의 복잡한 구조, 특히 `USING (subquery)` 형태나 `ON (...)` 조건절의 조인 관계를 완벽하게 추출하지 못할 수 있습니다.
- **검토 의견**: **[개선 권장]**. 테이블 이름 자체는 추출될 수 있으나, 정확한 조인 관계 누락은 전체적인 데이터 흐름 파악에 문제를 일으킵니다. `SELECT` 문의 `JOIN` 분석과 동일한 수준으로 `MERGE` 문의 `ON` 조건절 분석 기능을 강화할 필요가 있습니다.

### 2.2. 목표와 연관성이 낮은 문제

#### 가. CTE 재귀 쿼리 분석 기능 부족
- **문제점**: 보고서는 재귀적 CTE 분석이 불가하다고 지적합니다.
- **검토 의견**: **[후순위/불필요]**. 말씀하신 대로, 우리의 목표는 **CTE 구문 내에서 사용되는 테이블과 컬럼, 조인 조건을 추출하는 것**이지, 재귀의 논리적 흐름을 이해하는 것이 아닙니다. 현재 SQL 파서가 `WITH` 절 내의 쿼리에서 테이블 목록을 가져올 수 있다면, 최우선 목표 달성에는 문제가 없습니다. 이 부분에 대한 개선은 우선순위가 매우 낮습니다.

#### 나. 데이터 중복 문제 (파일, SQL 컴포넌트)
- **문제점**: 동일한 파일이나 쿼리가 중복으로 DB에 저장되어 통계를 왜곡하고 공간을 낭비합니다.
- **검토 의견**: **[후순위/불필요]**. 이 문제는 데이터의 '누락'이 아닌 '정합성 및 효율성'에 관한 문제입니다. 물론 중요한 문제이지만, 최우선 목표인 '하나도 빠짐없이 찾아내는 것'과는 방향성이 다릅니다. 파싱 능력 개선으로 최대한 많은 정보를 수집한 후, 후처리 단계에서 중복을 제거하는 방식으로 접근하는 것이 효율적입니다.

#### 다. 동적 테이블명/컬럼명 처리 (`${tableName}`)
- **문제점**: 파라미터로 테이블이나 컬럼명이 전달되는 경우, 정적 분석만으로는 실제 어떤 테이블이 사용될지 알 수 없습니다.
- **검토 의견**: **[현 수준 유지]**. 이는 정적 분석의 명백한 한계입니다. 모든 실행 가능한 경우의 수를 추론하는 것은 현실적으로 불가능에 가깝습니다. 이 부분은 분석의 한계로 명시하고, 가능한 설정 파일 등에서 기본값을 읽어오는 수준의 제한적인 지원만 고려하는 것이 합리적입니다.

## 3. 결론 및 우선순위 제안

'누락 없는 데이터 추출' 목표를 달성하기 위해 다음 순서로 개선 작업을 진행할 것을 제안합니다.

1.  **P0 (최우선)**
    *   **MyBatis 동적 SQL (`<if>`) 분석 강화**: 가장 빈번하게 발생하는 누락 해결.
    *   **MyBatis `<include>` 태그 지원**: 구조적으로 발생하는 대규모 누락 해결.
    *   **Java 동적 SQL (`+` 연산자) 기본 지원**: Java 코드로부터의 누락 해결.

2.  **P1 (차순위)**
    *   **MERGE 구문 조인 분석 강화**: 조인 관계 데이터의 정확성 확보.
    *   **Java `String.format` 패턴 지원 확대**: Java 코드 분석 커버리지 확대.

3.  **P2 (후순위)**
    *   **데이터 중복 제거 로직 구현**: 수집된 데이터의 정합성 및 효율성 확보.
    *   **CTE, 복잡한 서브쿼리 분석 고도화**: 현재 수준으로도 목표 달성에 큰 문제는 없으나, 완성도를 높이기 위한 개선.
