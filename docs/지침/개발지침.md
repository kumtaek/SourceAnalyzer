# SourceAnalyzer 개발지침

## 1. 프로젝트 개요

SourceAnalyzer는 연관관계 도출에 집중하는 소스코드 분석 도구입니다. 복잡한 전체 문법 파싱보다는 파일 간 호출관계, 데이터 흐름, 아키텍처 레이어 간의 연관성을 효율적으로 추출하는 것이 목표입니다.

### 핵심 철학

- 연관관계 중심 분석: 완전한 파싱보다 관계 추출에 집중
- 공통 함수 활용: 하드코딩 지양, 재사용 가능한 공통 모듈 우선 사용
- 설정 기반 처리: 패턴과 키워드를 설정 파일로 관리
- 오류 처리 강화: 예외 발생 시 handle_error()로 명확한 종료

## 2. 프로젝트 구조

```
D:\Analyzer\SourceAnalyzer\
├── source_analyzer.py      # 메인 분석기 (분석→메타데이터 생성)
├── create_report.py        # 리포트 생성기 (분리)
├── config\                 # 설정 파일들
│   ├── config.yaml        # 메인 설정
│   └── logging.yaml       # 로깅 설정
├── util\                  # 공통 유틸리티 모듈
├── parser\                # XML, SQL, Java 분석기들
├── reports\               # 리포트 생성 모듈
├── projects\              # 분석 대상 소스코드 (예: SampleSrc)
├── docs\                  # 문서화 (설계문서, 리포트)
│   └── 지침\             # 개발지침, Mermaid 오류조치
├── database\              # DB DDL 스크립트
├── logs\                  # 실행 로그
└── temp\                  # 임시 파일 (테스트용, 언제든 삭제 가능)
```

## 3. 개발 규칙

### 3.1 코딩 스타일

- Python 3.10+ 사용
- 4-space 들여쓰기
- snake_case: 모듈/함수명
- PascalCase: 클래스명
- UPPER_CASE: 상수
- kebab-case: 설정 키 (config.yaml 매칭)
- 이모지 사용 금지 (인코딩 문제)

### 3.2 공통 모듈 사용 원칙

- **경로 처리**: `util.path_utils` 공통 함수 사용, 절대 경로 등 하드코딩 금지
- **로깅**: `print` 대신 `util.logger` 사용
- **설정**: `config/parser/*.yaml`의 패턴/키워드 설정 활용
- **예외 처리**: 모든 예외는 `handle_error()`로 명확히 종료
- **CSV 파일 처리**: 
  - 로딩: 자동 인코딩 감지 (chardet 사용)
  - 저장: CP949 인코딩 (Excel 호환성)

### 3.3 파서 개발 지침

- 읽기 전용 파일 절대 제거/비활성화 금지
- 동일 쿼리, 메소드는 다른 파일에 있으면 중복으로 간주하지 않음

### 3.4 프로젝트 설정

- **메타데이터베이스**: SQLite 사용 (분석 결과 저장용)
- **분석 대상**: Oracle 기반 쿼리를 포함한 소스코드
- 프로젝트 루트: 현재 작업 디렉터리(D:\Analyzer\SourceAnalyzer) 기준 동적 해결
- 개발, 운영 현재 작업 디렉터리는 다를 수 있으므로 절대경로가 아닌 상대경로만 사용
- 개발은 Windows, 운영은 RHEL. 크로스플랫폼 대응 개발

## 4. 실행 및 테스트

### 4.1 기본 실행

```cmd
# 메타데이터 생성 (분석→메타데이터 통합)
cd D:\Analyzer\SourceAnalyzer
python source_analyzer.py --project-name SampleSrc --clear-metadb

# 리포트 생성 (분리된 실행)
python create_report.py --project-name SampleSrc

# 드라이런 (검증만)
python source_analyzer.py --project-name SampleSrc --dry-run
```

### 4.2 테스트

- 자동화 테스트: `tests/` 하위에 패키지 구조 미러링
- 실행: `pytest -q`
- 수동 테스트: `test_unit_result.txt`에 결과 문서화
- 컴파일 체크: `python -m compileall .`

### 4.3 로그 관리

- `main.py`는 3일(24*3시간) 이상 된 ./logs폴더에 파일 자동 삭제

## 5. 문서화 및 리포팅

### 5.1 질의응답 시스템

- 질의: `docs/qna/Q_{timestamp}_{질의제목}.md`
- 응답: `docs/qna/A_{timestamp}_{질의제목}.md`

### 5.2 보고파일 생성 경로

- 요청 시: `docs/report/{보고서종류}_{timestamp}_{주요내용제목}.md`
- 영향평가/검토 시 `./temp`, `./projects` 기본 제외

## 6. 터미널 및 명령어 처리

### 6.1 Windows 환경 주의사항

- `$` 프롬프트 표기 제거 (Linux 표기법, Windows에서 오류 발생)
- Python 다중 라인 실행 시 `\` 대신 별도 스크립트 파일 사용 권장

### 6.2 터미널 멈춤 대비 리디렉션 활용

- 모든 장시간 실행 명령은 `> ./temp/output.log 2>&1` 형태로 리디렉션
- 에러 발생 시에도 로그 파일 읽어서 상황 파악 가능

## 7. 승인 및 수정 정책

### 7.2 승인 필요 상황

- 의견 제시나 제안만 하는 경우 반드시 승인 요청
- 작업이 모호하거나 에러 발생 시 승인 요청
- 새로운 파일 생성 (특히 `improved`, `new`, `enhanced` 접두사) 시 허락 요청

## 8. 파일 관리 원칙

### 8.1 기본 원칙

- 기존 파일 편집 우선, 무분별한 새 파일 생성 최소화
- 폴더/파일 구조 변경 금지

### 8.2 임시 파일 관리

- 테스트용, 임시용도 파일은 `./temp/` 저장
- `./temp/` 내용은 신뢰하지 않고 참고용으로만 사용
- 작업 완료 후 임시 파일 정리

## 9. 다이어그램 작성

### 9.1 Mermaid 다이어그램

- 상세한 Mermaid 작성 규칙은 `docs/지침/Mermaid오류조치방법.md` 참조
- 기본 원칙: HTML 엔티티 사용, 큰따옴표 감싸기, 단순 문법 우선

## 10. 커밋 및 버전 관리

### 10.1 커밋 메시지

- 한글 명령형 (예: "시각화완성16")
- 50자 이내
- 필요시 영문 힌트 괄호 추가

### 10.2 설정 파일 관리

- `config/logging.yaml` 확장 시 기존 구조 유지

## 11. 특수 규칙

### 11.1 중복 방지

- 동일 내용의 문서 중복 작성 금지
- 기존 문서 확인 후 통합 또는 참조 방식 선택

### 11.2 데이터베이스 관련

- **메타데이터베이스**: SQLite 기반 (분석 결과 저장)
- **분석 대상 쿼리**: Oracle 문법 해석 및 분석
- 메타데이터 테이블 구조는 `database/create_table_script.sql` 참조

### 11.3 분석 대상 제외

- `./temp/`: 임시 파일, 분석/영향평가 대상 제외
- `./projects/`: 분석 소스코드, 영향평가 시 기본 제외

이 지침을 따라 SourceAnalyzer의 일관된 개발과 유지보수를 수행합니다.
