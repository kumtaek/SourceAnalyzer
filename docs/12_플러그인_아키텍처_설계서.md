# 플러그인 아키텍처 설계서

## 문서 정보
- **작성일**: 2025-01-17
- **버전**: v1.0
- **목적**: 소스코드 분석을 위한 플러그인 아키텍처 설계 및 구현 계획

## 1. 설계 개요

### 1.1 목적
SourceAnalyzer를 플러그인 아키텍처로 전환하여 다양한 프론트엔드 기술을 확장 가능하게 지원하는 시스템 구축

### 1.2 지원 기술 범위
```
분석 대상 기술:
- Java (.java)
- XML (.xml)
- JSP (.jsp)
- Vue.js (.vue)
- React JSX (.jsx)
- JavaScript (.js)
- TypeScript (.ts, .tsx)
```

### 1.3 개발 계획
1. **1차 개발**: Vue, React, JavaScript, TypeScript 플러그인
2. **2차 개발**: Angular, Svelte, Next.js, Nuxt.js, SvelteKit 플러그인

## 2. 플러그인 인터페이스 설계

### 2.1 기본 인터페이스
```python
from abc import ABC, abstractmethod
from typing import Dict, List, Any

class AnalyzerPlugin(ABC):
    """분석기 플러그인 인터페이스"""
    
    @abstractmethod
    def analyze(self, file_path: str) -> Dict[str, Any]:
        """파일 분석 메인 메서드"""
        pass
    
    @abstractmethod
    def get_supported_extensions(self) -> List[str]:
        """지원하는 파일 확장자 목록"""
        pass
    
    @abstractmethod
    def get_plugin_name(self) -> str:
        """플러그인 이름"""
        pass
    
    def get_priority(self) -> int:
        """우선순위 (낮을수록 높은 우선순위)"""
        return 100
    
    def validate_file(self, file_path: str) -> bool:
        """파일 유효성 검증"""
        return True
    
    def get_analysis_result_schema(self) -> Dict[str, Any]:
        """분석 결과 스키마 정의"""
        return {
            "components": [],
            "relationships": [],
            "metadata": {}
        }
```

### 2.2 플러그인 매니저
```python
class PluginManager:
    """플러그인 관리자"""
    
    def __init__(self):
        self.plugins = {}
        self.plugin_config = {}
        self.load_plugins()
    
    def load_plugins(self):
        """플러그인 동적 로드"""
        # 1차: 필수 플러그인
        self.register_plugin(JavaPlugin())
        self.register_plugin(XMLPlugin())
        self.register_plugin(JSPPlugin())
        self.register_plugin(VuePlugin())
        self.register_plugin(ReactPlugin())
        self.register_plugin(JavaScriptPlugin())
        self.register_plugin(TypeScriptPlugin())
    
    def register_plugin(self, plugin: AnalyzerPlugin):
        """플러그인 등록"""
        plugin_name = plugin.get_plugin_name()
        self.plugins[plugin_name] = plugin
        
        # 확장자별 매핑 업데이트
        for ext in plugin.get_supported_extensions():
            if ext not in self.plugin_config:
                self.plugin_config[ext] = []
            self.plugin_config[ext].append(plugin)
    
    def get_analyzer_for_extension(self, file_extension: str) -> AnalyzerPlugin:
        """파일 확장자에 맞는 최적 분석기 반환"""
        if file_extension not in self.plugin_config:
            return None
        
        plugins = self.plugin_config[file_extension]
        return min(plugins, key=lambda p: p.get_priority())
    
    def get_all_supported_extensions(self) -> List[str]:
        """지원하는 모든 파일 확장자 목록"""
        return list(self.plugin_config.keys())
```

## 3. 1차 개발 플러그인

### 3.1 Vue.js 플러그인
```python
class VuePlugin(AnalyzerPlugin):
    """Vue.js 파일 분석 플러그인"""
    
    def __init__(self):
        self.patterns = {
            'api_calls': [
                r'axios\.(get|post|put|delete)\s*\(\s*["\']([^"\']+)["\']',
                r'fetch\s*\(\s*["\']([^"\']+)["\']',
                r'\$\.(ajax|get|post)\s*\('
            ],
            'components': [
                r'<([A-Z][a-zA-Z0-9]*)\s',
                r'import\s+([A-Z][a-zA-Z0-9]*)\s+from'
            ],
            'methods': [
                r'methods\s*:\s*\{([^}]+)\}',
                r'(\w+)\s*\(\s*\)\s*\{'
            ]
        }
    
    def analyze(self, file_path: str) -> Dict[str, Any]:
        """Vue 파일 분석"""
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()
        
        result = {
            'components': [],
            'relationships': [],
            'metadata': {
                'file_type': 'vue',
                'vue_version': self._detect_vue_version(content)
            }
        }
        
        # API 호출 추출
        api_calls = self._extract_api_calls(content)
        result['relationships'].extend(api_calls)
        
        # 컴포넌트 추출
        components = self._extract_components(content)
        result['components'].extend(components)
        
        return result
    
    def get_supported_extensions(self) -> List[str]:
        return ['.vue']
    
    def get_plugin_name(self) -> str:
        return "Vue.js Analyzer"
    
    def get_priority(self) -> int:
        return 10
    
    def _detect_vue_version(self, content: str) -> str:
        """Vue 버전 감지"""
        if 'setup(' in content or 'defineComponent' in content:
            return '3.x'
        return '2.x'
    
    def _extract_api_calls(self, content: str) -> List[Dict]:
        """API 호출 추출"""
        # 구현 예시
        return []
    
    def _extract_components(self, content: str) -> List[Dict]:
        """컴포넌트 추출"""
        # 구현 예시
        return []
```

### 3.2 React 플러그인
```python
class ReactPlugin(AnalyzerPlugin):
    """React JSX 파일 분석 플러그인"""
    
    def __init__(self):
        self.patterns = {
            'api_calls': [
                r'fetch\s*\(\s*["\']([^"\']+)["\']',
                r'axios\.(get|post|put|delete)\s*\(\s*["\']([^"\']+)["\']',
                r'\.get\s*\(\s*["\']([^"\']+)["\']',
                r'\.post\s*\(\s*["\']([^"\']+)["\']'
            ],
            'components': [
                r'export\s+default\s+function\s+([A-Z][a-zA-Z0-9]*)',
                r'const\s+([A-Z][a-zA-Z0-9]*)\s*=\s*\(',
                r'class\s+([A-Z][a-zA-Z0-9]*)\s+extends'
            ],
            'hooks': [
                r'useState\s*\([^)]*\)',
                r'useEffect\s*\([^)]*\)',
                r'useCallback\s*\([^)]*\)'
            ]
        }
    
    def analyze(self, file_path: str) -> Dict[str, Any]:
        """React JSX 파일 분석"""
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()
        
        result = {
            'components': [],
            'relationships': [],
            'metadata': {
                'file_type': 'react',
                'react_version': self._detect_react_version(content),
                'hooks_used': self._extract_hooks(content)
            }
        }
        
        # 컴포넌트 추출
        components = self._extract_components(content)
        result['components'].extend(components)
        
        # API 호출 추출
        api_calls = self._extract_api_calls(content)
        result['relationships'].extend(api_calls)
        
        return result
    
    def get_supported_extensions(self) -> List[str]:
        return ['.jsx']
    
    def get_plugin_name(self) -> str:
        return "React Analyzer"
    
    def get_priority(self) -> int:
        return 20
    
    def _detect_react_version(self, content: str) -> str:
        """React 버전 감지"""
        if 'useState' in content or 'useEffect' in content:
            return 'hooks (16.8+)'
        return 'class-based'
    
    def _extract_hooks(self, content: str) -> List[str]:
        """React Hooks 추출"""
        # 구현 예시
        return []
    
    def _extract_components(self, content: str) -> List[Dict]:
        """React 컴포넌트 추출"""
        # 구현 예시
        return []
    
    def _extract_api_calls(self, content: str) -> List[Dict]:
        """API 호출 추출"""
        # 구현 예시
        return []
```

### 3.3 JavaScript 플러그인
```python
class JavaScriptPlugin(AnalyzerPlugin):
    """JavaScript 파일 분석 플러그인"""
    
    def __init__(self):
        self.patterns = {
            'api_calls': [
                r'fetch\s*\(\s*["\']([^"\']+)["\']',
                r'axios\.(get|post|put|delete)\s*\(\s*["\']([^"\']+)["\']',
                r'\$\.(ajax|get|post)\s*\(\s*["\']([^"\']+)["\']'
            ],
            'functions': [
                r'function\s+(\w+)\s*\(',
                r'const\s+(\w+)\s*=\s*\([^)]*\)\s*=>',
                r'(\w+)\s*:\s*function\s*\('
            ],
            'exports': [
                r'export\s+default\s+(\w+)',
                r'module\.exports\s*=\s*(\w+)',
                r'export\s+{\s*([^}]+)\s*}'
            ]
        }
    
    def analyze(self, file_path: str) -> Dict[str, Any]:
        """JavaScript 파일 분석"""
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()
        
        result = {
            'components': [],
            'relationships': [],
            'metadata': {
                'file_type': 'javascript',
                'module_type': self._detect_module_type(content)
            }
        }
        
        # 함수 추출
        functions = self._extract_functions(content)
        result['components'].extend(functions)
        
        # API 호출 추출
        api_calls = self._extract_api_calls(content)
        result['relationships'].extend(api_calls)
        
        # Export 분석
        exports = self._extract_exports(content)
        result['metadata']['exports'] = exports
        
        return result
    
    def get_supported_extensions(self) -> List[str]:
        return ['.js']
    
    def get_plugin_name(self) -> str:
        return "JavaScript Analyzer"
    
    def get_priority(self) -> int:
        return 30
    
    def _detect_module_type(self, content: str) -> str:
        """모듈 타입 감지"""
        if 'import ' in content or 'export ' in content:
            return 'ES6'
        elif 'require(' in content or 'module.exports' in content:
            return 'CommonJS'
        return 'legacy'
    
    def _extract_functions(self, content: str) -> List[Dict]:
        """함수 추출"""
        # 구현 예시
        return []
    
    def _extract_api_calls(self, content: str) -> List[Dict]:
        """API 호출 추출"""
        # 구현 예시
        return []
    
    def _extract_exports(self, content: str) -> List[str]:
        """Export 분석"""
        # 구현 예시
        return []
```

## 4. 2차 개발 플러그인

### 4.1 Angular 플러그인
```python
class AngularPlugin(AnalyzerPlugin):
    """Angular 파일 분석 플러그인"""
    
    def get_supported_extensions(self) -> List[str]:
        return ['.ts', '.html', '.scss']
    
    def get_plugin_name(self) -> str:
        return "Angular Analyzer"
    
    def get_priority(self) -> int:
        return 40
```

### 4.2 Svelte 플러그인
```python
class SveltePlugin(AnalyzerPlugin):
    """Svelte 파일 분석 플러그인"""
    
    def get_supported_extensions(self) -> List[str]:
        return ['.svelte']
    
    def get_plugin_name(self) -> str:
        return "Svelte Analyzer"
    
    def get_priority(self) -> int:
        return 50
```

### 4.3 Next.js 플러그인
```python
class NextJSPlugin(AnalyzerPlugin):
    """Next.js 파일 분석 플러그인"""
    
    def get_supported_extensions(self) -> List[str]:
        return ['.jsx', '.tsx', '.js', '.ts']
    
    def get_plugin_name(self) -> str:
        return "Next.js Analyzer"
    
    def get_priority(self) -> int:
        return 60
```

### 4.4 Nuxt.js 플러그인
```python
class NuxtJSPlugin(AnalyzerPlugin):
    """Nuxt.js 파일 분석 플러그인"""
    
    def get_supported_extensions(self) -> List[str]:
        return ['.vue', '.js', '.ts']
    
    def get_plugin_name(self) -> str:
        return "Nuxt.js Analyzer"
    
    def get_priority(self) -> int:
        return 70
```

### 4.5 SvelteKit 플러그인
```python
class SvelteKitPlugin(AnalyzerPlugin):
    """SvelteKit 파일 분석 플러그인"""
    
    def get_supported_extensions(self) -> List[str]:
        return ['.svelte', '.js', '.ts']
    
    def get_plugin_name(self) -> str:
        return "SvelteKit Analyzer"
    
    def get_priority(self) -> int:
        return 80
```

### 3.4 TypeScript 플러그인
```python
class TypeScriptPlugin(AnalyzerPlugin):
    """TypeScript 파일 분석 플러그인"""
    
    def get_supported_extensions(self) -> List[str]:
        return ['.ts', '.tsx']
    
    def get_plugin_name(self) -> str:
        return "TypeScript Analyzer"
    
    def get_priority(self) -> int:
        return 90
```

## 5. 구현 계획

### 5.1 1차 개발 범위 (백엔드 호출 빈도 높음)

**연결관계 분석 목적**: 백엔드 API 호출이 일반적인 프론트엔드 기술 우선 개발

#### **1차 개발 순서**
1. **Vue.js 플러그인** (우선순위: 1)
   - Vue 2.x/3.x 컴포넌트 분석
   - axios, fetch API 호출 추출
   - 파일 확장자: `.vue`
   - 백엔드 호출 패턴: 컴포넌트 내 `<script>` 섹션에서 API 호출

2. **React 플러그인** (우선순위: 2)
   - React JSX 컴포넌트 분석
   - axios, fetch API 호출 추출
   - 파일 확장자: `.jsx`
   - 백엔드 호출 패턴: 컴포넌트 내에서 useEffect, 이벤트 핸들러를 통한 API 호출

3. **JavaScript 플러그인** (우선순위: 3)
   - JavaScript API 서비스 모듈 분석
   - axios, fetch, jQuery Ajax 호출 추출
   - 파일 확장자: `.js`
   - 백엔드 호출 패턴: API 서비스 함수, 유틸리티 모듈

4. **TypeScript 플러그인** (우선순위: 4)
   - TypeScript 파일 분석
   - axios, fetch API 호출 추출
   - 파일 확장자: `.ts`, `.tsx`
   - 백엔드 호출 패턴: 타입 안전성을 갖춘 API 호출

#### **1차 개발 근거**
- **Vue.js**: 컴포넌트 기반 프레임워크로 백엔드 API 통신이 핵심 기능
- **React**: 컴포넌트 라이브러리로 백엔드 데이터 통신이 일반적
- **JavaScript**: 모든 프론트엔드 기술의 기반으로 API 호출 빈도 높음
- **TypeScript**: JavaScript의 타입 안전 버전으로 백엔드 호출 패턴 동일

### 5.2 2차 개발 (향후 확장용 - 프레임워크 특화)

**개발 조건**: 1차 개발 완료 후 또는 특정 프로젝트에서 해당 기술 사용 시

#### **2차 개발 대상**
1. **Angular 플러그인**
   - Angular 컴포넌트 분석
   - HttpClient를 통한 백엔드 통신
   - 파일 확장자: `.ts`, `.html`
   - 특화 기능: 의존성 주입, 서비스 계층 분석

2. **Svelte 플러그인**
   - Svelte 컴포넌트 분석
   - fetch API 호출 추출
   - 파일 확장자: `.svelte`
   - 특화 기능: 컴파일 타임 최적화된 API 호출

3. **Next.js 플러그인**
   - React 기반 SSR 프레임워크 분석
   - API Routes, 서버사이드 API 호출
   - 파일 확장자: `.js`, `.jsx`, `.ts`, `.tsx`
   - 특화 기능: SSR/SSG 환경에서의 API 호출

4. **Nuxt.js 플러그인**
   - Vue.js 기반 SSR 프레임워크 분석
   - 서버사이드 렌더링과 API 통신
   - 파일 확장자: `.vue`, `.js`, `.ts`
   - 특화 기능: Nuxt의 서버/클라이언트 API 호출

5. **SvelteKit 플러그인**
   - Svelte 메타프레임워크 분석
   - 서버사이드 렌더링과 백엔드 통신
   - 파일 확장자: `.svelte`, `.js`, `.ts`
   - 특화 기능: SvelteKit의 서버/클라이언트 분리

#### **2차 개발 근거**
- **프레임워크 특화**: 각 프레임워크의 고유한 백엔드 호출 패턴
- **SSR 지원**: 서버사이드 렌더링 환경에서의 API 호출 분석
- **확장성**: 다양한 프론트엔드 기술 스택 지원
- **수요 기반**: 실제 프로젝트에서 사용 시 개발

### 5.3 분석 제외 대상

**백엔드 호출 불가능한 파일 유형**:
- **스타일 파일**: `.css`, `.scss`, `.sass`, `.less`
- **정적 마크업**: `.html`, `.htm` (JavaScript 없이는 백엔드 호출 불가)
- **설정 파일**: `.json`, `.yaml`, `.yml`, `.xml` (프론트엔드용)

## 6. 설정 파일 확장

### 6.1 플러그인 설정 (config/plugins.yaml)
```yaml
plugins:
  # 1차 개발 플러그인 (백엔드 호출 빈도 높음)
  vue:
    enabled: true
    priority: 10
    description: "Vue.js 컴포넌트 분석 (백엔드 API 호출 빈도 높음)"
    patterns:
      api_calls:
        - "axios.get"
        - "axios.post"
        - "axios.put"
        - "axios.delete"
        - "fetch("
        - "$.ajax"
  
  react:
    enabled: true
    priority: 20
    description: "React JSX 컴포넌트 분석 (백엔드 API 호출 빈도 높음)"
    patterns:
      api_calls:
        - "fetch("
        - "axios."
        - "useEffect"
        - "componentDidMount"
  
  javascript:
    enabled: true
    priority: 30
    description: "JavaScript API 서비스 모듈 분석 (백엔드 API 호출 빈도 높음)"
    patterns:
      api_calls:
        - "fetch("
        - "axios."
        - "$.ajax"
        - "$.get"
        - "$.post"
        - "XMLHttpRequest"
  
  typescript:
    enabled: true
    priority: 40
    description: "TypeScript 파일 분석 (백엔드 API 호출 빈도 높음)"
    patterns:
      api_calls:
        - "fetch("
        - "axios."
        - "HttpClient"
        - "Observable"
  
  # 2차 개발 플러그인 (향후 확장용 - 프레임워크 특화)
  angular:
    enabled: false
    priority: 50
    description: "Angular 컴포넌트 분석 (프레임워크 특화)"
    development_phase: "2차"
  
  svelte:
    enabled: false
    priority: 60
    description: "Svelte 컴포넌트 분석 (프레임워크 특화)"
    development_phase: "2차"
  
  nextjs:
    enabled: false
    priority: 70
    description: "Next.js 프레임워크 분석 (SSR 특화)"
    development_phase: "2차"
  
  nuxt:
    enabled: false
    priority: 80
    description: "Nuxt.js 프레임워크 분석 (SSR 특화)"
    development_phase: "2차"
  
  sveltekit:
    enabled: false
    priority: 90
    description: "SvelteKit 메타프레임워크 분석 (SSR 특화)"
    development_phase: "2차"

# 개발 단계별 활성화 정책
development_policy:
  phase1:
    target: "백엔드 호출 빈도 높은 기술 우선 개발"
    plugins: ["vue", "react", "javascript", "typescript"]
    rationale: "연결관계 분석 목적에 가장 효과적"
  
  phase2:
    target: "프레임워크 특화 및 SSR 지원"
    plugins: ["angular", "svelte", "nextjs", "nuxt", "sveltekit"]
    rationale: "다양한 프론트엔드 기술 스택 지원"
    trigger: "1차 개발 완료 후 또는 특정 프로젝트 요청 시"
```

## 7. 마이그레이션 계획

### 7.1 기존 파서 → 플러그인 전환
```
기존 구조:
parser/
├── java_parser.py
├── xml_parser.py
├── jsp_parser.py
└── sql_parser.py

새로운 구조:
plugins/
├── base_plugin.py
├── java_plugin.py      # java_parser.py → 변환
├── xml_plugin.py       # xml_parser.py → 변환
├── jsp_plugin.py       # jsp_parser.py → 변환
├── sql_plugin.py       # sql_parser.py → 변환
├── vue_plugin.py       # 신규 개발
├── react_plugin.py     # 신규 개발
└── js_plugin.py        # 신규 개발
```

### 7.2 호환성 유지
- 기존 파서 로직을 플러그인으로 점진적 전환
- 기존 분석 결과와 동일한 메타데이터 생성
- 설정 파일 호환성 유지

## 8. 테스트 계획

### 8.1 단위 테스트
```python
def test_vue_plugin():
    plugin = VueAnalyzerPlugin()
    result = plugin.analyze("test.vue")
    assert result['metadata']['file_type'] == 'vue'

def test_react_plugin():
    plugin = ReactAnalyzerPlugin()
    result = plugin.analyze("test.jsx")
    assert result['metadata']['file_type'] == 'react'
```

### 8.2 통합 테스트
- 전체 프로젝트 분석 테스트
- 기존 분석 결과와 일치성 검증
- 플러그인 우선순위 테스트

이 설계서를 바탕으로 플러그인 아키텍처를 구현하여 다양한 프론트엔드 기술을 지원하는 소스코드 분석 시스템을 구축할 수 있습니다.
