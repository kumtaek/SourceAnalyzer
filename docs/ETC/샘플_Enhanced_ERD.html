<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SourceAnalyzer - Enhanced ERD</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; margin: 0; padding: 20px; background: #f8f9fa; }
        .header { background: linear-gradient(135deg, #2196F3 0%, #21CBF3 100%); color: white; padding: 30px; border-radius: 10px; margin-bottom: 30px; text-align: center; }
        .content { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .legend { display: flex; gap: 20px; margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 5px; }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .legend-color { width: 15px; height: 15px; border-radius: 3px; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .stat-item { background: #e3f2fd; padding: 15px; border-radius: 5px; text-align: center; }
        .stat-number { font-size: 1.8em; font-weight: bold; color: #1976d2; }
        .mermaid { background: white; padding: 20px; border-radius: 5px; }
        .table-info { margin-top: 30px; }
        .table-info table { width: 100%; border-collapse: collapse; }
        .table-info th, .table-info td { padding: 8px 12px; border: 1px solid #ddd; text-align: left; }
        .table-info th { background: #f1f3f4; }
        .high-usage { background: #ffebee; }
        .medium-usage { background: #fff3e0; }
        .low-usage { background: #f3e5f5; }
    </style>
</head>
<body>
    <div class="header">
        <h1>🗄️ Enhanced ERD - SampleSrc</h1>
        <p>실제 사용 관계까지 포함한 확장 ERD | 생성일: 2025-09-20 14:30:25</p>
    </div>

    <div class="content">
        <div class="stats">
            <div class="stat-item">
                <div class="stat-number">23</div>
                <div>총 테이블</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">156</div>
                <div>총 컬럼</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">45</div>
                <div>테이블 조인</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">67</div>
                <div>SQL 쿼리</div>
            </div>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #ff6b6b;"></div>
                <span>높은 사용빈도 (10회 이상)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #4ecdc4;"></div>
                <span>중간 사용빈도 (3-9회)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #95a5a6;"></div>
                <span>낮은 사용빈도 (1-2회)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f39c12;"></div>
                <span>고아 테이블 (사용 안됨)</span>
            </div>
        </div>

        <div class="mermaid">
erDiagram
    USERS {
        NUMBER id PK "사용자 고유 식별자"
        VARCHAR2 username "사용자명"
        VARCHAR2 email "이메일 주소"
        VARCHAR2 password "암호화된 비밀번호"
        DATE created_at "계정 생성일시"
    }
    
    USER_PROFILES {
        NUMBER profile_id PK "프로필 고유 ID"
        NUMBER user_id FK "사용자 ID"
        VARCHAR2 first_name "이름"
        VARCHAR2 last_name "성"
        VARCHAR2 phone "전화번호"
    }
    
    ORDERS {
        NUMBER order_id PK "주문ID"
        NUMBER customer_id FK "고객ID"
        DATE order_date "주문일시"
        NUMBER total_amount "총 주문금액"
        VARCHAR2 status "주문상태"
    }
    
    ORDER_ITEMS {
        NUMBER item_id PK "주문항목ID"
        NUMBER order_id FK "주문ID"
        NUMBER product_id FK "상품ID"
        NUMBER quantity "수량"
        NUMBER unit_price "단가"
    }
    
    PRODUCTS {
        NUMBER product_id PK "상품ID"
        VARCHAR2 product_name "상품명"
        NUMBER category_id FK "카테고리ID"
        NUMBER price "가격"
        NUMBER stock_quantity "재고수량"
    }
    
    CATEGORIES {
        NUMBER category_id PK "카테고리ID"
        VARCHAR2 category_name "카테고리명"
        NUMBER parent_id FK "상위카테고리ID"
    }
    
    CUSTOMERS {
        NUMBER customer_id PK "고객ID"
        VARCHAR2 customer_name "고객명"
        VARCHAR2 phone "전화번호"
        VARCHAR2 email "이메일"
    }
    
    %% 실제 사용 관계 (메타DB에서 추출)
    USERS ||--o{ USER_PROFILES : "1:1 프로필"
    CUSTOMERS ||--o{ ORDERS : "1:N 주문"
    ORDERS ||--o{ ORDER_ITEMS : "1:N 주문항목"
    PRODUCTS ||--o{ ORDER_ITEMS : "1:N 상품주문"
    CATEGORIES ||--o{ PRODUCTS : "1:N 상품분류"
    CATEGORIES ||--o{ CATEGORIES : "계층구조"
    
    %% 실제 SQL에서 발견된 암시적 조인 (점선)
    USERS }o--o{ ORDERS : "사용자별 주문이력"
    PRODUCTS }o--o{ CATEGORIES : "상품 카테고리 검색"
        </div>

        <div class="table-info">
            <h3>📊 테이블별 사용 현황</h3>
            <table>
                <tr>
                    <th>테이블명</th>
                    <th>사용 쿼리 수</th>
                    <th>관련 Java 클래스</th>
                    <th>사용 빈도</th>
                    <th>상태</th>
                </tr>
                <tr class="high-usage">
                    <td><strong>USERS</strong></td>
                    <td>15개</td>
                    <td>UserController, UserService, UserDao</td>
                    <td>높음</td>
                    <td>✅ 핵심 테이블</td>
                </tr>
                <tr class="high-usage">
                    <td><strong>ORDERS</strong></td>
                    <td>12개</td>
                    <td>OrderController, OrderService</td>
                    <td>높음</td>
                    <td>✅ 핵심 테이블</td>
                </tr>
                <tr class="medium-usage">
                    <td><strong>PRODUCTS</strong></td>
                    <td>8개</td>
                    <td>ProductController, ProductService</td>
                    <td>중간</td>
                    <td>✅ 정상</td>
                </tr>
                <tr class="medium-usage">
                    <td><strong>ORDER_ITEMS</strong></td>
                    <td>6개</td>
                    <td>OrderService, OrderDao</td>
                    <td>중간</td>
                    <td>✅ 정상</td>
                </tr>
                <tr class="low-usage">
                    <td><strong>USER_PROFILES</strong></td>
                    <td>2개</td>
                    <td>UserProfileService</td>
                    <td>낮음</td>
                    <td>⚠️ 활용도 낮음</td>
                </tr>
                <tr class="low-usage">
                    <td><strong>CATEGORIES</strong></td>
                    <td>3개</td>
                    <td>ProductService</td>
                    <td>낮음</td>
                    <td>⚠️ 활용도 낮음</td>
                </tr>
                <tr style="background: #fff3cd;">
                    <td><strong>AUDIT_LOG</strong></td>
                    <td>0개</td>
                    <td>없음</td>
                    <td>없음</td>
                    <td>❌ 고아 테이블</td>
                </tr>
                <tr style="background: #fff3cd;">
                    <td><strong>SYSTEM_CONFIG</strong></td>
                    <td>0개</td>
                    <td>없음</td>
                    <td>없음</td>
                    <td>❌ 고아 테이블</td>
                </tr>
            </table>
        </div>
    </div>

    <script>
        mermaid.initialize({startOnLoad: true});
    </script>
</body>
</html>
