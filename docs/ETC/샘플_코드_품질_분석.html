<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SourceAnalyzer - 코드 품질 분석</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; margin: 0; padding: 20px; background: #f8f9fa; }
        .header { background: linear-gradient(135deg, #fd79a8 0%, #fdcb6e 100%); color: white; padding: 30px; border-radius: 10px; margin-bottom: 30px; text-align: center; }
        .quality-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .chart-container { height: 250px; position: relative; }
        .heatmap-container { height: 400px; border: 1px solid #ddd; border-radius: 5px; overflow: hidden; }
        .quality-score { text-align: center; padding: 20px; }
        .score-circle { width: 120px; height: 120px; border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 2em; font-weight: bold; color: white; }
        .score-excellent { background: linear-gradient(135deg, #00b894, #00cec9); }
        .score-good { background: linear-gradient(135deg, #fdcb6e, #e17055); }
        .score-poor { background: linear-gradient(135deg, #fd79a8, #e84393); }
        .issue-list { max-height: 300px; overflow-y: auto; }
        .issue-item { padding: 10px; margin: 5px 0; border-radius: 5px; }
        .issue-critical { background: #ffebee; border-left: 4px solid #f44336; }
        .issue-warning { background: #fff3e0; border-left: 4px solid #ff9800; }
        .issue-info { background: #e8f5e8; border-left: 4px solid #4caf50; }
        .complexity-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .complexity-table th, .complexity-table td { padding: 8px 12px; border: 1px solid #ddd; text-align: left; }
        .complexity-table th { background: #f1f3f4; }
        .complexity-high { background: #ffcdd2; }
        .complexity-medium { background: #fff3e0; }
        .complexity-low { background: #c8e6c9; }
    </style>
</head>
<body>
    <div class="header">
        <h1>📊 코드 품질 분석</h1>
        <p>코드 복잡도, 에러율, 유지보수성 종합 분석 | SampleSrc 프로젝트</p>
    </div>

    <div class="quality-grid">
        <div class="card">
            <h3>🎯 전체 품질 점수</h3>
            <div class="quality-score">
                <div class="score-circle score-good">78</div>
                <div><strong>양호</strong> (100점 만점)</div>
                <p>평균 이상의 코드 품질을 유지하고 있습니다.</p>
            </div>
        </div>

        <div class="card">
            <h3>📈 품질 지표 분포</h3>
            <div class="chart-container">
                <canvas id="qualityChart"></canvas>
            </div>
        </div>

        <div class="card">
            <h3>🔥 복잡도 히트맵</h3>
            <div id="complexityHeatmap" class="heatmap-container"></div>
        </div>

        <div class="card">
            <h3>⚠️ 품질 이슈</h3>
            <div class="issue-list">
                <div class="issue-item issue-critical">
                    <strong>🚨 심각</strong>: ComplexQueryMapper.xml - 150줄 초과 복잡 쿼리
                </div>
                <div class="issue-item issue-critical">
                    <strong>🚨 심각</strong>: OrderService.processComplexOrder() - 순환 복잡도 15
                </div>
                <div class="issue-item issue-warning">
                    <strong>⚠️ 경고</strong>: UserController - 메서드 수 과다 (18개)
                </div>
                <div class="issue-item issue-warning">
                    <strong>⚠️ 경고</strong>: ProductService - 중복 코드 발견 (3곳)
                </div>
                <div class="issue-item issue-info">
                    <strong>ℹ️ 정보</strong>: CategoryDao - 사용되지 않는 메서드 2개
                </div>
                <div class="issue-item issue-info">
                    <strong>ℹ️ 정보</strong>: AUDIT_LOG 테이블 - 참조 없음 (고아 테이블)
                </div>
            </div>
        </div>

        <div class="card">
            <h3>📊 파일별 복잡도 분석</h3>
            <div class="chart-container">
                <canvas id="complexityChart"></canvas>
            </div>
        </div>

        <div class="card">
            <h3>📋 상세 복잡도 리포트</h3>
            <table class="complexity-table">
                <thead>
                    <tr>
                        <th>파일명</th>
                        <th>라인 수</th>
                        <th>메서드 수</th>
                        <th>복잡도</th>
                        <th>에러 수</th>
                        <th>등급</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="complexity-high">
                        <td><strong>ComplexQueryMapper.xml</strong></td>
                        <td>245줄</td>
                        <td>12개 쿼리</td>
                        <td>9.2</td>
                        <td>2개</td>
                        <td>🔴 높음</td>
                    </tr>
                    <tr class="complexity-high">
                        <td><strong>OrderService.java</strong></td>
                        <td>180줄</td>
                        <td>8개</td>
                        <td>8.7</td>
                        <td>1개</td>
                        <td>🔴 높음</td>
                    </tr>
                    <tr class="complexity-medium">
                        <td><strong>UserController.java</strong></td>
                        <td>156줄</td>
                        <td>15개</td>
                        <td>6.3</td>
                        <td>0개</td>
                        <td>🟡 중간</td>
                    </tr>
                    <tr class="complexity-medium">
                        <td><strong>ProductService.java</strong></td>
                        <td>134줄</td>
                        <td>10개</td>
                        <td>5.8</td>
                        <td>1개</td>
                        <td>🟡 중간</td>
                    </tr>
                    <tr class="complexity-low">
                        <td><strong>UserDao.java</strong></td>
                        <td>89줄</td>
                        <td>7개</td>
                        <td>3.2</td>
                        <td>0개</td>
                        <td>🟢 낮음</td>
                    </tr>
                    <tr class="complexity-low">
                        <td><strong>CategoryService.java</strong></td>
                        <td>67줄</td>
                        <td>4개</td>
                        <td>2.1</td>
                        <td>0개</td>
                        <td>🟢 낮음</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // 품질 지표 분포 차트
        const qualityCtx = document.getElementById('qualityChart').getContext('2d');
        new Chart(qualityCtx, {
            type: 'radar',
            data: {
                labels: ['복잡도', '가독성', '재사용성', '테스트성', '유지보수성'],
                datasets: [{
                    label: 'SampleSrc',
                    data: [6.8, 7.2, 8.1, 6.5, 7.8],
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    pointBackgroundColor: 'rgba(54, 162, 235, 1)'
                }, {
                    label: '업계 평균',
                    data: [7.0, 7.0, 7.0, 7.0, 7.0],
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    pointBackgroundColor: 'rgba(255, 99, 132, 1)'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: {
                        beginAtZero: true,
                        max: 10
                    }
                }
            }
        });

        // 복잡도 분포 차트
        const complexityCtx = document.getElementById('complexityChart').getContext('2d');
        new Chart(complexityCtx, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: '파일별 복잡도',
                    data: [
                        {x: 245, y: 9.2, label: 'ComplexQueryMapper.xml'},
                        {x: 180, y: 8.7, label: 'OrderService.java'},
                        {x: 156, y: 6.3, label: 'UserController.java'},
                        {x: 134, y: 5.8, label: 'ProductService.java'},
                        {x: 89, y: 3.2, label: 'UserDao.java'},
                        {x: 67, y: 2.1, label: 'CategoryService.java'}
                    ],
                    backgroundColor: function(context) {
                        const value = context.parsed.y;
                        if (value > 8) return '#f44336';
                        if (value > 5) return '#ff9800';
                        return '#4caf50';
                    }
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { 
                        title: { display: true, text: '라인 수' },
                        beginAtZero: true
                    },
                    y: { 
                        title: { display: true, text: '복잡도 점수' },
                        beginAtZero: true
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.raw.label}: ${context.parsed.x}줄, 복잡도 ${context.parsed.y}`;
                            }
                        }
                    }
                }
            }
        });

        // D3.js로 복잡도 히트맵 생성
        const heatmapData = [
            {file: 'UserController', method: 'login', complexity: 8.5},
            {file: 'UserController', method: 'register', complexity: 6.2},
            {file: 'UserController', method: 'updateProfile', complexity: 7.1},
            {file: 'ProductService', method: 'searchProducts', complexity: 9.1},
            {file: 'ProductService', method: 'createProduct', complexity: 5.8},
            {file: 'OrderService', method: 'processOrder', complexity: 9.8},
            {file: 'OrderService', method: 'cancelOrder', complexity: 7.3}
        ];

        // 히트맵 구현 (D3.js)
        const margin = {top: 20, right: 20, bottom: 60, left: 100};
        const width = 400 - margin.left - margin.right;
        const height = 300 - margin.top - margin.bottom;

        const svg = d3.select("#complexityHeatmap")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // 색상 스케일
        const colorScale = d3.scaleSequential(d3.interpolateRdYlGn)
            .domain([10, 0]); // 복잡도가 높을수록 빨간색

        // 히트맵 셀 그리기
        heatmapData.forEach((d, i) => {
            svg.append("rect")
                .attr("x", (i % 3) * 80)
                .attr("y", Math.floor(i / 3) * 40)
                .attr("width", 75)
                .attr("height", 35)
                .attr("fill", colorScale(d.complexity))
                .attr("stroke", "#fff")
                .attr("stroke-width", 2);
                
            svg.append("text")
                .attr("x", (i % 3) * 80 + 37.5)
                .attr("y", Math.floor(i / 3) * 40 + 20)
                .attr("text-anchor", "middle")
                .attr("fill", "white")
                .attr("font-size", "10px")
                .attr("font-weight", "bold")
                .text(`${d.method}\n${d.complexity}`);
        });
    </script>
</body>
</html>
