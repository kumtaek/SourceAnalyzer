<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SourceAnalyzer - í˜¸ì¶œ ì²´ì¸ ì¶”ì ê¸°</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; margin: 0; padding: 20px; background: #f8f9fa; }
        .header { background: linear-gradient(135deg, #8e44ad 0%, #3498db 100%); color: white; padding: 30px; border-radius: 10px; margin-bottom: 30px; text-align: center; }
        .controls { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .control-group { display: flex; gap: 15px; align-items: center; margin: 10px 0; }
        .control-group label { font-weight: bold; min-width: 120px; }
        .control-group select, .control-group input { padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .trace-button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .trace-button:hover { background: #0056b3; }
        .content { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .full-width { grid-column: 1 / -1; }
        .chain-network { height: 500px; border: 2px solid #ddd; border-radius: 8px; }
        .sequence-diagram { background: #fafafa; padding: 20px; border-radius: 8px; }
        .chain-step { display: flex; align-items: center; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .step-1 { background: linear-gradient(90deg, #ff6b6b, #ffa8a8); color: white; }
        .step-2 { background: linear-gradient(90deg, #4ecdc4, #7fdddd); color: white; }
        .step-3 { background: linear-gradient(90deg, #45b7d1, #87ceeb); color: white; }
        .step-4 { background: linear-gradient(90deg, #96ceb4, #c4e5d4); color: white; }
        .step-5 { background: linear-gradient(90deg, #feca57, #fed766); color: white; }
        .step-number { font-size: 1.5em; font-weight: bold; margin-right: 15px; width: 30px; text-align: center; }
        .performance-info { background: #e8f4f8; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .bottleneck { background: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; border-radius: 5px; margin: 5px 0; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ”— í˜¸ì¶œ ì²´ì¸ ì¶”ì ê¸°</h1>
        <p>ì‚¬ìš©ì ìš”ì²­ë¶€í„° ë°ì´í„°ë² ì´ìŠ¤ê¹Œì§€ ì „ì²´ ì‹¤í–‰ ê²½ë¡œ ì¶”ì </p>
    </div>

    <div class="controls">
        <h3>ğŸ¯ ì¶”ì  ëŒ€ìƒ ì„ íƒ</h3>
        <div class="control-group">
            <label>ì‹œì‘ì  ì„ íƒ:</label>
            <select id="startPoint">
                <option value="login_jsp">login.jsp (ë¡œê·¸ì¸ í™”ë©´)</option>
                <option value="userlist_jsp">userList.jsp (ì‚¬ìš©ì ëª©ë¡)</option>
                <option value="api_user_login">/api/user/login (ë¡œê·¸ì¸ API)</option>
                <option value="user_controller">UserController.login()</option>
            </select>
        </div>
        <div class="control-group">
            <label>ì¶”ì  ê¹Šì´:</label>
            <select id="traceDepth">
                <option value="3">3ë‹¨ê³„ (Frontend â†’ API â†’ Backend)</option>
                <option value="5" selected>5ë‹¨ê³„ (Frontend â†’ Database)</option>
                <option value="7">7ë‹¨ê³„ (ì „ì²´ ì²´ì¸)</option>
            </select>
        </div>
        <div class="control-group">
            <button class="trace-button" onclick="startTrace()">ğŸ” ì¶”ì  ì‹œì‘</button>
        </div>
    </div>

    <div class="content">
        <div class="card full-width">
            <h3>ğŸ“Š í˜¸ì¶œ ì²´ì¸ ë„¤íŠ¸ì›Œí¬ (ì‚¬ìš©ì ë¡œê·¸ì¸ ì‹œë‚˜ë¦¬ì˜¤)</h3>
            <div id="chainNetwork" class="chain-network"></div>
        </div>

        <div class="card">
            <h3>ğŸ­ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨</h3>
            <div class="sequence-diagram">
                <div class="mermaid">
sequenceDiagram
    participant U as ì‚¬ìš©ì
    participant J as login.jsp
    participant A as /api/user/login
    participant C as UserController
    participant S as UserService
    participant D as UserDao
    participant X as UserMapper.xml
    participant DB as USERS í…Œì´ë¸”
    
    U->>J: ë¡œê·¸ì¸ ì •ë³´ ì…ë ¥
    J->>A: AJAX POST ìš”ì²­
    A->>C: login() ë©”ì„œë“œ í˜¸ì¶œ
    C->>S: authenticateUser() í˜¸ì¶œ
    S->>D: findByUsername() í˜¸ì¶œ
    D->>X: selectUserByUsername ì¿¼ë¦¬
    X->>DB: SELECT * FROM USERS WHERE USERNAME=?
    DB-->>X: ì‚¬ìš©ì ì •ë³´ ë°˜í™˜
    X-->>D: User ê°ì²´ ë°˜í™˜
    D-->>S: User ê°ì²´ ë°˜í™˜
    S-->>C: ì¸ì¦ ê²°ê³¼ ë°˜í™˜
    C-->>A: JSON ì‘ë‹µ
    A-->>J: ë¡œê·¸ì¸ ê²°ê³¼
    J-->>U: í™”ë©´ ì „í™˜/ì˜¤ë¥˜ í‘œì‹œ
                </div>
            </div>
        </div>

        <div class="card">
            <h3>âš¡ ì„±ëŠ¥ ë¶„ì„</h3>
            
            <div class="performance-info">
                <h4>ğŸ“ˆ ì˜ˆìƒ ì‹¤í–‰ ì‹œê°„ ë¶„ì„</h4>
                <ul>
                    <li><strong>Frontend ì²˜ë¦¬</strong>: ~50ms (DOM ì¡°ì‘, AJAX ìš”ì²­)</li>
                    <li><strong>ë„¤íŠ¸ì›Œí¬ ì§€ì—°</strong>: ~20ms (ë¡œì»¬ í™˜ê²½ ê¸°ì¤€)</li>
                    <li><strong>Controller/Service</strong>: ~10ms (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)</li>
                    <li><strong>Database ì¿¼ë¦¬</strong>: ~5ms (ì¸ë±ìŠ¤ ì‚¬ìš©)</li>
                    <li><strong>ì´ ì˜ˆìƒ ì‹œê°„</strong>: ~85ms</li>
                </ul>
            </div>

            <div class="bottleneck">
                <h4>âš ï¸ ì ì¬ì  ë³‘ëª© ì§€ì </h4>
                <ul>
                    <li><strong>UserMapper.xml</strong>: ë³µì¡í•œ WHERE ì¡°ê±´ (3ê°œ í…Œì´ë¸” ì¡°ì¸)</li>
                    <li><strong>UserService.authenticateUser()</strong>: ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” ê²€ì¦</li>
                    <li><strong>login.jsp</strong>: ë™ê¸°ì‹ í¼ ì²˜ë¦¬ (ë¹„ë™ê¸° ê¶Œì¥)</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="content">
        <div class="card full-width">
            <h3>ğŸ“‹ ë‹¨ê³„ë³„ í˜¸ì¶œ ì²´ì¸ ìƒì„¸</h3>
            
            <div class="chain-step step-1">
                <div class="step-number">1</div>
                <div>
                    <strong>Frontend ì‹œì‘ì </strong><br/>
                    login.jsp â†’ ì‚¬ìš©ì ì…ë ¥ í¼ â†’ AJAX ìš”ì²­ ìƒì„±
                </div>
            </div>
            
            <div class="chain-step step-2">
                <div class="step-number">2</div>
                <div>
                    <strong>API í˜¸ì¶œ</strong><br/>
                    /api/user/login â†’ POST ìš”ì²­ â†’ UserController.login() ë¼ìš°íŒ…
                </div>
            </div>
            
            <div class="chain-step step-3">
                <div class="step-number">3</div>
                <div>
                    <strong>ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§</strong><br/>
                    UserController â†’ UserService.authenticateUser() â†’ ì¸ì¦ ë¡œì§ ì‹¤í–‰
                </div>
            </div>
            
            <div class="chain-step step-4">
                <div class="step-number">4</div>
                <div>
                    <strong>ë°ì´í„° ì ‘ê·¼</strong><br/>
                    UserService â†’ UserDao.findByUsername() â†’ MyBatis ë§¤í¼ í˜¸ì¶œ
                </div>
            </div>
            
            <div class="chain-step step-5">
                <div class="step-number">5</div>
                <div>
                    <strong>ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬</strong><br/>
                    UserMapper.xml â†’ SELECT * FROM USERS WHERE USERNAME=? â†’ USERS í…Œì´ë¸” ì ‘ê·¼
                </div>
            </div>
        </div>
    </div>

    <script>
        mermaid.initialize({startOnLoad: true});

        // í˜¸ì¶œ ì²´ì¸ ë„¤íŠ¸ì›Œí¬ë¥¼ SVGë¡œ ëŒ€ì²´
        const chainSvg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        chainSvg.setAttribute("width", "100%");
        chainSvg.setAttribute("height", "500");
        chainSvg.style.background = "#fafafa";
        
        // ê°„ë‹¨í•œ ì²´ì¸ ë‹¤ì´ì–´ê·¸ë¨ ìƒì„±
        const chainHtml = `
            <svg width="100%" height="500" style="background: #fafafa;">
                <g transform="translate(50, 50)">
                    <rect x="0" y="0" width="100" height="40" rx="5" fill="#ff6b6b"/>
                    <text x="50" y="25" text-anchor="middle" fill="white" font-size="12">ğŸ‘¤ ì‚¬ìš©ì</text>
                </g>
                <g transform="translate(50, 120)">
                    <rect x="0" y="0" width="100" height="40" rx="5" fill="#ff9800"/>
                    <text x="50" y="25" text-anchor="middle" fill="white" font-size="10">login.jsp</text>
                </g>
                <g transform="translate(50, 190)">
                    <rect x="0" y="0" width="120" height="40" rx="5" fill="#4ecdc4"/>
                    <text x="60" y="25" text-anchor="middle" fill="white" font-size="10">/api/user/login</text>
                </g>
                <g transform="translate(50, 260)">
                    <rect x="0" y="0" width="100" height="40" rx="5" fill="#45b7d1"/>
                    <text x="50" y="25" text-anchor="middle" fill="white" font-size="10">UserController</text>
                </g>
                <g transform="translate(50, 330)">
                    <rect x="0" y="0" width="100" height="40" rx="5" fill="#2ecc71"/>
                    <text x="50" y="25" text-anchor="middle" fill="white" font-size="10">UserService</text>
                </g>
                <g transform="translate(50, 400)">
                    <ellipse cx="50" cy="20" rx="50" ry="20" fill="#9b59b6"/>
                    <text x="50" y="25" text-anchor="middle" fill="white" font-size="10">USERS í…Œì´ë¸”</text>
                </g>
                
                <!-- ì—°ê²°ì„  ë° ë‹¨ê³„ ë²ˆí˜¸ -->
                <line x1="100" y1="90" x2="100" y2="120" stroke="#007bff" stroke-width="3" marker-end="url(#arrow)"/>
                <text x="110" y="110" fill="#007bff" font-size="14" font-weight="bold">1</text>
                
                <line x1="100" y1="160" x2="100" y2="190" stroke="#007bff" stroke-width="3" marker-end="url(#arrow)"/>
                <text x="110" y="180" fill="#007bff" font-size="14" font-weight="bold">2</text>
                
                <line x1="110" y1="230" x2="100" y2="260" stroke="#007bff" stroke-width="3" marker-end="url(#arrow)"/>
                <text x="120" y="250" fill="#007bff" font-size="14" font-weight="bold">3</text>
                
                <line x1="100" y1="300" x2="100" y2="330" stroke="#007bff" stroke-width="3" marker-end="url(#arrow)"/>
                <text x="110" y="320" fill="#007bff" font-size="14" font-weight="bold">4</text>
                
                <line x1="100" y1="370" x2="100" y2="400" stroke="#007bff" stroke-width="3" marker-end="url(#arrow)"/>
                <text x="110" y="390" fill="#007bff" font-size="14" font-weight="bold">5</text>
                
                <defs>
                    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#007bff"/>
                    </marker>
                </defs>
            </svg>
        `;
        
        document.getElementById('chainNetwork').innerHTML = chainHtml;

        function startTrace() {
            alert('í˜¸ì¶œ ì²´ì¸ ì¶”ì ì„ ì‹œì‘í•©ë‹ˆë‹¤!\nì„ íƒí•œ ì‹œì‘ì ë¶€í„° ë°ì´í„°ë² ì´ìŠ¤ê¹Œì§€ì˜ ì „ì²´ ê²½ë¡œë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.');
        }
    </script>
</body>
</html>
