<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SourceAnalyzer - 영향도 분석 리포트</title>
    <script src="https://unpkg.com/cytoscape@3.21.0/dist/cytoscape.min.js"></script>
    <script src="https://unpkg.com/dagre@0.8.5/dist/dagre.min.js"></script>
    <script src="https://unpkg.com/cytoscape-dagre@2.4.0/cytoscape-dagre.js"></script>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; margin: 0; padding: 20px; background: #f8f9fa; }
        .header { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); color: white; padding: 30px; border-radius: 10px; margin-bottom: 30px; text-align: center; }
        .analysis-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .impact-network { height: 500px; border: 2px solid #ddd; border-radius: 10px; margin: 20px 0; }
        .impact-level { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .level-1 { background: #ffebee; border-left: 4px solid #f44336; }
        .level-2 { background: #fff3e0; border-left: 4px solid #ff9800; }
        .level-3 { background: #e8f5e8; border-left: 4px solid #4caf50; }
        .component-list { max-height: 300px; overflow-y: auto; }
        .component-item { padding: 8px; margin: 5px 0; background: #f8f9fa; border-radius: 3px; display: flex; justify-content: space-between; }
        .risk-high { border-left: 4px solid #f44336; }
        .risk-medium { border-left: 4px solid #ff9800; }
        .risk-low { border-left: 4px solid #4caf50; }
        .change-scenario { background: #e3f2fd; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .action-item { background: #fff3e0; padding: 10px; margin: 5px 0; border-radius: 3px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>🎯 영향도 분석 리포트</h1>
        <p>변경 시나리오: <strong>USERS 테이블의 USERNAME 컬럼 VARCHAR2(50) → VARCHAR2(100) 변경</strong></p>
        <p>분석 일시: 2025-09-20 14:30:25</p>
    </div>

    <div class="analysis-container">
        <div class="card">
            <h3>📋 영향도 요약</h3>
            
            <div class="impact-level level-1">
                <h4>🚨 직접 영향 (Level 1)</h4>
                <p><strong>15개 컴포넌트</strong>가 즉시 영향을 받습니다</p>
                <ul>
                    <li>SQL 쿼리: 8개</li>
                    <li>Java 메서드: 5개</li>
                    <li>JSP 페이지: 2개</li>
                </ul>
            </div>

            <div class="impact-level level-2">
                <h4>⚠️ 간접 영향 (Level 2)</h4>
                <p><strong>23개 컴포넌트</strong>가 간접적으로 영향을 받습니다</p>
                <ul>
                    <li>Service 클래스: 6개</li>
                    <li>Controller 클래스: 4개</li>
                    <li>DTO 클래스: 8개</li>
                    <li>JSP 화면: 5개</li>
                </ul>
            </div>

            <div class="impact-level level-3">
                <h4>ℹ️ 연쇄 영향 (Level 3)</h4>
                <p><strong>12개 컴포넌트</strong>가 연쇄적으로 영향을 받을 수 있습니다</p>
                <ul>
                    <li>Frontend 컴포넌트: 7개</li>
                    <li>API 엔드포인트: 3개</li>
                    <li>기타 관련 테이블: 2개</li>
                </ul>
            </div>
        </div>

        <div class="card">
            <h3>🎯 핵심 영향 컴포넌트</h3>
            
            <div class="component-list">
                <div class="component-item risk-high">
                    <span><strong>UserMapper.xml</strong> - selectUserByUsername</span>
                    <span>🚨 높음</span>
                </div>
                <div class="component-item risk-high">
                    <span><strong>UserDao.java</strong> - findByUsername()</span>
                    <span>🚨 높음</span>
                </div>
                <div class="component-item risk-high">
                    <span><strong>LoginService.java</strong> - authenticateUser()</span>
                    <span>🚨 높음</span>
                </div>
                <div class="component-item risk-medium">
                    <span><strong>UserController.java</strong> - login()</span>
                    <span>⚠️ 중간</span>
                </div>
                <div class="component-item risk-medium">
                    <span><strong>userList.jsp</strong> - 사용자 목록 화면</span>
                    <span>⚠️ 중간</span>
                </div>
                <div class="component-item risk-medium">
                    <span><strong>UserDto.java</strong> - username 필드</span>
                    <span>⚠️ 중간</span>
                </div>
                <div class="component-item risk-low">
                    <span><strong>UserSearchService.java</strong> - searchUsers()</span>
                    <span>✅ 낮음</span>
                </div>
                <div class="component-item risk-low">
                    <span><strong>/api/user/search</strong> - API</span>
                    <span>✅ 낮음</span>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <h3>🔗 영향 전파 네트워크</h3>
        <div id="impactNetwork" class="impact-network"></div>
    </div>

    <div class="card">
        <h3>📝 변경 시나리오별 분석</h3>
        
        <div class="change-scenario">
            <h4>시나리오 1: 컬럼 크기 확장 (VARCHAR2 50→100)</h4>
            <p><strong>영향도: 중간</strong> | 예상 작업 시간: 2-3시간</p>
            
            <div class="action-item">
                <strong>필수 작업:</strong>
                <ul>
                    <li>UserMapper.xml의 resultMap 검토</li>
                    <li>UserDto.java의 validation 규칙 수정</li>
                    <li>Frontend 입력 필드 maxlength 수정</li>
                </ul>
            </div>
            
            <div class="action-item">
                <strong>테스트 대상:</strong>
                <ul>
                    <li>로그인 기능 테스트</li>
                    <li>사용자 등록 기능 테스트</li>
                    <li>사용자 검색 기능 테스트</li>
                </ul>
            </div>
        </div>

        <div class="change-scenario">
            <h4>시나리오 2: 컬럼 삭제</h4>
            <p><strong>영향도: 높음</strong> | 예상 작업 시간: 1-2일</p>
            
            <div class="action-item">
                <strong>⚠️ 위험 요소:</strong>
                <ul>
                    <li>15개 SQL 쿼리에서 해당 컬럼 참조</li>
                    <li>5개 Java 클래스에서 직접 사용</li>
                    <li>2개 JSP에서 화면 표시</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Cytoscape.js로 영향 전파 네트워크 시각화
        const cy = cytoscape({
            container: document.getElementById('impactNetwork'),
            
            elements: [
                // 노드들
                { data: { id: 'users_table', label: 'USERS 테이블', type: 'table' } },
                { data: { id: 'user_mapper', label: 'UserMapper.xml', type: 'xml' } },
                { data: { id: 'user_dao', label: 'UserDao.java', type: 'java' } },
                { data: { id: 'user_service', label: 'UserService.java', type: 'java' } },
                { data: { id: 'user_controller', label: 'UserController.java', type: 'java' } },
                { data: { id: 'login_jsp', label: 'login.jsp', type: 'jsp' } },
                { data: { id: 'user_list_jsp', label: 'userList.jsp', type: 'jsp' } },
                { data: { id: 'api_login', label: '/api/user/login', type: 'api' } },
                
                // 관계들 (영향 전파 방향)
                { data: { source: 'users_table', target: 'user_mapper', impact: 'direct' } },
                { data: { source: 'user_mapper', target: 'user_dao', impact: 'direct' } },
                { data: { source: 'user_dao', target: 'user_service', impact: 'direct' } },
                { data: { source: 'user_service', target: 'user_controller', impact: 'indirect' } },
                { data: { source: 'user_controller', target: 'api_login', impact: 'indirect' } },
                { data: { source: 'api_login', target: 'login_jsp', impact: 'chain' } },
                { data: { source: 'user_service', target: 'user_list_jsp', impact: 'indirect' } }
            ],
            
            style: [
                {
                    selector: 'node',
                    style: {
                        'label': 'data(label)',
                        'text-valign': 'center',
                        'color': 'white',
                        'font-size': '12px',
                        'width': '120px',
                        'height': '40px',
                        'shape': 'roundrectangle'
                    }
                },
                {
                    selector: 'node[type="table"]',
                    style: { 'background-color': '#f44336' }
                },
                {
                    selector: 'node[type="xml"]',
                    style: { 'background-color': '#ff9800' }
                },
                {
                    selector: 'node[type="java"]',
                    style: { 'background-color': '#2196f3' }
                },
                {
                    selector: 'node[type="jsp"]',
                    style: { 'background-color': '#4caf50' }
                },
                {
                    selector: 'node[type="api"]',
                    style: { 'background-color': '#9c27b0' }
                },
                {
                    selector: 'edge[impact="direct"]',
                    style: {
                        'line-color': '#f44336',
                        'target-arrow-color': '#f44336',
                        'target-arrow-shape': 'triangle',
                        'width': 3
                    }
                },
                {
                    selector: 'edge[impact="indirect"]',
                    style: {
                        'line-color': '#ff9800',
                        'target-arrow-color': '#ff9800',
                        'target-arrow-shape': 'triangle',
                        'width': 2
                    }
                },
                {
                    selector: 'edge[impact="chain"]',
                    style: {
                        'line-color': '#4caf50',
                        'target-arrow-color': '#4caf50',
                        'target-arrow-shape': 'triangle',
                        'width': 1,
                        'line-style': 'dashed'
                    }
                }
            ],
            
            layout: {
                name: 'dagre',
                rankDir: 'TB',
                spacingFactor: 1.5
            }
        });
    </script>
</body>
</html>
